import{j as e,aj as y,d as S,k as p,h as E,i as k,B as I,J as L,K as z,Z as B,s as $}from"./ui-components-CL-10tNC.js";import{r as d,u as C,N as P,O as T}from"./react-vendor-NfsKhbMh.js";import{b as O,c as q}from"./index-DNL726t5.js";import"./supabase-DQ7Oc2S5.js";const w=()=>e.jsxs("div",{className:"flex flex-col flex-1 items-center justify-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-green-500"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"Loading..."})]}),A=({isOpen:o,onClose:t=()=>{},stores:a,currentStoreId:r,setCurrentStoreId:n,onSignOut:x})=>{const i=C(),h=s=>{n(s),t()},l=s=>{i(s),t()};return e.jsxs(e.Fragment,{children:[o&&e.jsx("div",{className:"fixed inset-0 z-40 lg:hidden",onClick:t,children:e.jsx("div",{className:"absolute inset-0 bg-gray-600 opacity-75"})}),e.jsx("div",{className:`
        ${o?"fixed inset-0 flex z-40":"hidden"}
        lg:flex lg:flex-col lg:fixed lg:inset-y-0 lg:z-50
      `,children:e.jsxs("div",{className:`
          flex-1 flex flex-col min-h-0 bg-green-700
          w-full lg:w-64
          transition-transform duration-300 ease-in-out
          ${o?"translate-x-0":"-translate-x-full"}
          lg:translate-x-0
        `,children:[e.jsxs("div",{className:"flex items-center justify-between h-16 flex-shrink-0 px-4 bg-green-800",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("h1",{className:"text-xl font-bold text-white",children:"Store Manager"})}),e.jsxs("button",{className:"lg:hidden text-white hover:text-gray-200 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white",onClick:t,children:[e.jsx("span",{className:"sr-only",children:"Close sidebar"}),e.jsx(y,{className:"h-6 w-6","aria-hidden":"true"})]})]}),e.jsx("div",{className:"flex-1 flex flex-col overflow-y-auto",children:e.jsx("nav",{className:"flex-1 px-2 py-4 space-y-1",children:a.length>0?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"px-2 pb-2 text-sm font-medium text-green-100 mb-2 border-b border-green-600",children:"Your Stores"}),a.map(s=>e.jsxs("button",{onClick:()=>h(s.id),className:`
                        ${r===s.id?"bg-green-800 text-white":"text-green-100 hover:bg-green-600"}
                        group flex items-center px-2 py-2 text-base font-medium rounded-md w-full
                        transition-colors duration-150
                      `,children:[e.jsx(S,{className:"mr-3 h-6 w-6"}),s.name]},s.id)),e.jsx("div",{className:"px-2 py-3 mt-4 border-t border-green-600",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("button",{onClick:()=>l("/store-manager/products"),className:"text-green-100 hover:bg-green-600 group flex items-center px-2 py-2 text-base font-medium rounded-md w-full",children:[e.jsx(p,{className:"mr-3 h-6 w-6"}),"Products"]}),e.jsxs("button",{onClick:()=>l("/store-manager/products/new"),className:"text-green-100 hover:bg-green-600 group flex items-center px-2 py-2 text-base font-medium rounded-md w-full",children:[e.jsx(p,{className:"mr-3 h-6 w-6"}),"Add New Product"]}),e.jsxs("button",{onClick:()=>l("/store-manager/orders"),className:"text-green-100 hover:bg-green-600 group flex items-center px-2 py-2 text-base font-medium rounded-md w-full",children:[e.jsx(p,{className:"mr-3 h-6 w-6"}),"Orders"]}),e.jsxs("button",{onClick:()=>l("/store-manager/settings"),className:"text-green-100 hover:bg-green-600 group flex items-center px-2 py-2 text-base font-medium rounded-md w-full",children:[e.jsx(E,{className:"mr-3 h-6 w-6"}),"Settings"]}),e.jsxs("button",{onClick:()=>{x(),t()},className:"text-green-100 hover:bg-green-600 group flex items-center px-2 py-2 text-base font-medium rounded-md w-full",children:[e.jsx(k,{className:"mr-3 h-6 w-6"}),"Sign Out"]})]})})]}):e.jsx("div",{className:"px-2 py-4 text-center text-green-100",children:e.jsx("p",{children:"No stores assigned"})})})})]})})]})},F=({onMenuClick:o,currentStore:t,onSignOut:a})=>{var i;const{manager:r}=O(),{currentTheme:n,toggleTheme:x}=q();return e.jsx("header",{className:"bg-theme-header shadow-sm z-10",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex justify-between h-16",children:[e.jsxs("div",{className:"flex",children:[e.jsxs("button",{type:"button",className:"px-4 border-r border-theme text-theme-secondary focus:outline-none focus:ring-2 focus:ring-inset focus:ring-green-500 lg:hidden",onClick:o,children:[e.jsx("span",{className:"sr-only",children:"Open sidebar"}),e.jsx(y,{className:"h-6 w-6 text-theme-secondary","aria-hidden":"true"})]}),t&&e.jsxs("div",{className:"flex items-center ml-4",children:[e.jsx(S,{className:"h-6 w-6 text-green-600 mr-2"}),e.jsx("h2",{className:"text-lg font-medium text-theme-primary",children:t.name})]})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(I,{variant:"ghost",onClick:x,className:"p-2 text-theme-secondary hover:text-theme-primary hover:bg-theme-tertiary transition-colors duration-200 mr-2","aria-label":`Switch to ${n==="light"?"dark":"light"} mode`,children:n==="light"?e.jsx(L,{className:"h-5 w-5"}):e.jsx(z,{className:"h-5 w-5"})}),e.jsxs("button",{type:"button",className:"ml-4 p-2 text-theme-secondary hover:text-theme-primary",children:[e.jsx("span",{className:"sr-only",children:"View notifications"}),e.jsx(B,{className:"h-6 w-6"})]}),e.jsxs("div",{className:"ml-4 flex items-center",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("div",{className:"h-10 w-10 rounded-full bg-green-500 flex items-center justify-center",children:e.jsx("span",{className:"text-lg font-medium text-white",children:((i=r==null?void 0:r.user_id)==null?void 0:i.substring(0,1).toUpperCase())||"M"})})}),e.jsx("div",{className:"ml-3",children:e.jsxs("button",{type:"button",className:"max-w-xs bg-white rounded-full flex items-center text-sm focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500",id:"user-menu-button",children:[e.jsx("span",{className:"sr-only",children:"Open user menu"}),e.jsxs("div",{className:"flex flex-col items-start",children:[e.jsx("span",{className:"text-sm font-medium text-gray-700",children:(r==null?void 0:r.user_id)||"Store Manager"}),e.jsxs("button",{onClick:a,className:"flex items-center text-xs text-gray-500 hover:text-red-500",children:[e.jsx(k,{className:"h-3 w-3 mr-1"}),"Sign out"]})]})]})})]})]})]})})})},J=()=>{const[o,t]=d.useState(!1),[a,r]=d.useState([]),[n,x]=d.useState(""),[i,h]=d.useState(null),l=C(),{manager:s,store:M,loading:g,logout:_}=O(),N=async()=>{await _(),l("/store-manager/login")};return d.useEffect(()=>{!g&&s&&(async()=>{if(s)try{const{data:c,error:b}=await $.from("store_managers").select(`
            *,
            stores(*)
          `).eq("user_id",s.user_id).eq("is_active",!0);if(b)throw b;const m=(c==null?void 0:c.map(u=>u.stores))||[];if(r(m),m.length>0){const u=new URLSearchParams(window.location.search).get("storeId"),v=u&&m.find(j=>j.id===u)?m.find(j=>j.id===u):m[0];x(v.id),h(v)}else console.warn("No stores assigned to this manager."),l("/store-manager/login",{replace:!0})}catch(c){console.error("Error fetching stores:",c),l("/store-manager/login",{replace:!0})}})()},[s,g,l]),d.useEffect(()=>{if(n&&a.length>0){const f=a.find(c=>c.id===n);f&&h(f)}},[n,a]),g?e.jsx(w,{}):!s||!M?e.jsx(P,{to:"/store-manager/login",replace:!0}):e.jsxs("div",{className:"h-screen flex overflow-hidden bg-theme-secondary",children:[e.jsx(A,{isOpen:o,onClose:()=>t(!1),stores:a,currentStoreId:n,setCurrentStoreId:x,onSignOut:N}),e.jsxs("div",{className:"flex flex-col w-0 flex-1 overflow-hidden",children:[e.jsx(F,{onMenuClick:()=>t(!0),currentStore:i,onSignOut:N}),e.jsx("main",{className:"flex-1 relative overflow-y-auto focus:outline-none",children:e.jsx("div",{className:"py-6",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 md:px-8",children:i&&e.jsx(d.Suspense,{fallback:e.jsx(w,{}),children:e.jsx(T,{context:{store:i,storeId:n}})})})})})]})]})};export{J as default};
