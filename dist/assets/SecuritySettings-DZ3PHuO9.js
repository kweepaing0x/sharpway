import{s as m,j as e,u as y,x as g,y as N,N as q,v as b,z as U,w as R,O as H,B as p,a9 as B,E as D,D as _,al as J,o as W}from"./ui-components-CL-10tNC.js";import{r as c}from"./react-vendor-NfsKhbMh.js";import{a as X}from"./index-DNL726t5.js";import"./supabase-DQ7Oc2S5.js";const Z=({userId:l,onStatusChange:a})=>{const[x,u]=c.useState(!1),[h,n]=c.useState(!1),[w,i]=c.useState(null),[A,j]=c.useState(null),[v,f]=c.useState("setup"),[C,$]=c.useState(""),[ee,M]=c.useState(""),[S,V]=c.useState(""),[d,I]=c.useState(""),[E,K]=c.useState([]),[o,F]=c.useState("");c.useEffect(()=>{L()},[l]);const L=async()=>{try{const{data:s,error:t}=await m.from("user_2fa").select("enabled").eq("user_id",l).maybeSingle();if(t)throw t;const r=(s==null?void 0:s.enabled)||!1;u(r),f(r?"enabled":"setup"),a==null||a(r)}catch(s){console.error("Error checking 2FA status:",s)}},Y=()=>{const s="ABCDEFGHIJKLMNOPQRSTUVWXYZ234567";let t="";for(let r=0;r<32;r++)t+=s.charAt(Math.floor(Math.random()*s.length));return t},O=()=>{const s=[];for(let t=0;t<10;t++){const r=Math.random().toString(36).substring(2,8).toUpperCase();s.push(r)}return s},P=async()=>{n(!0),i(null);try{const s=Y(),t=O();M(s),V(s),K(t);const G=`otpauth://totp/${encodeURIComponent("admin@mymall.com")}?secret=${s}&issuer=${encodeURIComponent("MyMall Admin")}`;$(`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(G)}`);const{error:k}=await m.from("user_2fa").upsert({user_id:l,secret:s,backup_codes:t,enabled:!1});if(k)throw k;f("verify")}catch(s){i(s.message)}finally{n(!1)}},Q=async()=>{if(!d||d.length!==6){i("Please enter a 6-digit verification code");return}n(!0),i(null);try{if(!(d.length===6&&/^\d+$/.test(d)))throw new Error("Invalid verification code");const{error:t}=await m.from("user_2fa").update({enabled:!0,last_used:new Date().toISOString()}).eq("user_id",l);if(t)throw t;const{error:r}=await m.from("users").update({requires_2fa:!0}).eq("id",l);if(r)throw r;u(!0),f("enabled"),j("Two-factor authentication has been successfully enabled!"),a==null||a(!0)}catch(s){i(s.message)}finally{n(!1)}},z=async()=>{if(!o||o.length!==6){i("Please enter a 6-digit verification code to disable 2FA");return}n(!0),i(null);try{if(!(o.length===6&&/^\d+$/.test(o)))throw new Error("Invalid verification code");const{error:t}=await m.from("user_2fa").delete().eq("user_id",l);if(t)throw t;const{error:r}=await m.from("users").update({requires_2fa:!1}).eq("id",l);if(r)throw r;u(!1),f("setup"),j("Two-factor authentication has been disabled"),F(""),a==null||a(!1)}catch(s){i(s.message)}finally{n(!1)}},T=async s=>{try{await navigator.clipboard.writeText(s),j("Copied to clipboard!"),setTimeout(()=>j(null),2e3)}catch{i("Failed to copy to clipboard")}};return e.jsxs(y,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(q,{className:"h-5 w-5 mr-2"}),"Two-Factor Authentication",x&&e.jsx("span",{className:"ml-2 px-2 py-1 bg-green-100 text-green-800 text-xs font-medium rounded-full",children:"Enabled"})]})}),e.jsxs(b,{className:"space-y-6",children:[w&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-md flex items-center",children:[e.jsx(U,{className:"h-5 w-5 mr-2"}),w]}),A&&e.jsxs("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded-md flex items-center",children:[e.jsx(R,{className:"h-5 w-5 mr-2"}),A]}),v==="setup"&&!x&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx(H,{className:"h-6 w-6 text-blue-600 mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900",children:"Enable Two-Factor Authentication"}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Add an extra layer of security to your admin account using Google Authenticator or any compatible TOTP app."})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-md",children:[e.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Before you start:"}),e.jsxs("ol",{className:"text-sm text-blue-800 space-y-1 list-decimal list-inside",children:[e.jsx("li",{children:"Install Google Authenticator on your mobile device"}),e.jsx("li",{children:"Make sure you have access to your device during setup"}),e.jsx("li",{children:"Save the backup codes in a secure location"})]})]}),e.jsxs(p,{onClick:P,isLoading:h,className:"w-full",children:[e.jsx(B,{className:"h-4 w-4 mr-2"}),"Set Up Two-Factor Authentication"]})]}),v==="verify"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"Scan QR Code"}),e.jsxs("div",{className:"flex flex-col items-center space-y-4",children:[C&&e.jsx("img",{src:C,alt:"QR Code for 2FA setup",className:"border rounded-lg"}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Can't scan the QR code? Enter this key manually:"}),e.jsxs("div",{className:"flex items-center space-x-2 bg-gray-50 p-3 rounded-md",children:[e.jsx("code",{className:"text-sm font-mono",children:S}),e.jsx(p,{variant:"ghost",size:"sm",onClick:()=>T(S),children:e.jsx(D,{className:"h-4 w-4"})})]})]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"Backup Codes"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Save these backup codes in a secure location. You can use them to access your account if you lose your device."}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md",children:[e.jsx("div",{className:"grid grid-cols-2 gap-2 text-sm font-mono",children:E.map((s,t)=>e.jsx("div",{className:"flex items-center justify-between",children:e.jsx("span",{children:s})},t))}),e.jsxs(p,{variant:"ghost",size:"sm",onClick:()=>T(E.join(`
`)),className:"mt-2",children:[e.jsx(D,{className:"h-4 w-4 mr-2"}),"Copy All Codes"]})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-900 mb-4",children:"Verify Setup"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Enter the 6-digit code from your authenticator app to complete setup:"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(_,{value:d,onChange:s=>I(s.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"text-center text-lg font-mono",maxLength:6}),e.jsx(p,{onClick:Q,isLoading:h,disabled:d.length!==6,children:"Verify & Enable"})]})]})]}),v==="enabled"&&x&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center space-x-3 text-green-700",children:[e.jsx(R,{className:"h-6 w-6"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:"Two-Factor Authentication is Active"}),e.jsx("p",{className:"text-sm text-green-600",children:"Your account is protected with an additional layer of security."})]})]}),e.jsxs("div",{className:"bg-yellow-50 border border-yellow-200 p-4 rounded-md",children:[e.jsx("h4",{className:"font-medium text-yellow-800 mb-2",children:"Important:"}),e.jsxs("ul",{className:"text-sm text-yellow-700 space-y-1 list-disc list-inside",children:[e.jsx("li",{children:"Keep your backup codes in a secure location"}),e.jsx("li",{children:"Don't lose access to your authenticator device"}),e.jsx("li",{children:"You'll need your authenticator code for each admin login"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium text-gray-900 mb-3",children:"Disable Two-Factor Authentication"}),e.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Enter a verification code from your authenticator app to disable 2FA:"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(_,{value:o,onChange:s=>F(s.target.value.replace(/\D/g,"").slice(0,6)),placeholder:"000000",className:"text-center text-lg font-mono",maxLength:6}),e.jsx(p,{variant:"danger",onClick:z,isLoading:h,disabled:o.length!==6,children:"Disable 2FA"})]})]})]})]})]})},le=()=>{const{user:l}=X(),[a,x]=c.useState(!1),u=h=>{x(h)};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Security Settings"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage your account security and authentication settings"})]}),e.jsxs(y,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(q,{className:"h-5 w-5 mr-2"}),"Security Overview"]})}),e.jsx(b,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:`p-2 rounded-full ${a?"bg-green-100":"bg-red-100"}`,children:e.jsx(B,{className:`h-5 w-5 ${a?"text-green-600":"text-red-600"}`})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Two-Factor Auth"}),e.jsx("p",{className:`text-sm ${a?"text-green-600":"text-red-600"}`,children:a?"Enabled":"Disabled"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-blue-100",children:e.jsx(J,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Admin Role"}),e.jsx("p",{className:"text-sm text-blue-600",children:"Active"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 rounded-full bg-green-100",children:e.jsx(W,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Session"}),e.jsx("p",{className:"text-sm text-green-600",children:"Active"})]})]})]})})]}),l&&e.jsx(Z,{userId:l.id,onStatusChange:u}),e.jsxs(y,{children:[e.jsx(g,{children:e.jsxs(N,{className:"flex items-center",children:[e.jsx(U,{className:"h-5 w-5 mr-2"}),"Security Recommendations"]})}),e.jsx(b,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:`mt-1 w-2 h-2 rounded-full ${a?"bg-green-500":"bg-red-500"}`}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Enable Two-Factor Authentication"}),e.jsx("p",{className:"text-sm text-gray-600",children:a?"Great! Your account is protected with 2FA.":"Add an extra layer of security to your admin account."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"mt-1 w-2 h-2 rounded-full bg-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Use Strong Passwords"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Your password should be at least 12 characters long and include a mix of letters, numbers, and symbols."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"mt-1 w-2 h-2 rounded-full bg-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Regular Security Reviews"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Review your security settings and active sessions regularly."})]})]}),e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:"mt-1 w-2 h-2 rounded-full bg-yellow-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Backup Recovery Codes"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Keep your 2FA backup codes in a secure location separate from your device."})]})]})]})})]}),e.jsxs(y,{children:[e.jsx(g,{children:e.jsx(N,{children:"Active Sessions"})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Current Session"}),e.jsxs("p",{className:"text-sm text-gray-600",children:[new Date().toLocaleDateString()," • ",navigator.userAgent.includes("Chrome")?"Chrome":"Browser"]})]})]}),e.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Active"})]})})})]})]})};export{le as default};
