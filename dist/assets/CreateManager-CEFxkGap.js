import{s as v,j as e,B as d,A as N,u as w,x as C,y as I,v as S,D as h,ac as M,ad as q,d as E,a6 as A}from"./ui-components-CL-10tNC.js";import{u as k,r as i}from"./react-vendor-NfsKhbMh.js";import"./supabase-DQ7Oc2S5.js";const T=()=>{const l=k(),[x,m]=i.useState(!1),[u,n]=i.useState(null),[p,j]=i.useState([]),[a,g]=i.useState({email:"",password:"",store_id:""});i.useEffect(()=>{f()},[]);const f=async()=>{try{const{data:s,error:r}=await v.from("stores").select("id, name").eq("is_active",!0).eq("approval_status","approved").order("name");if(r)throw r;j(s||[])}catch(s){console.error("Error fetching stores:",s),n(s.message)}},o=s=>{const{name:r,value:t}=s.target;g(c=>({...c,[r]:t}))},b=()=>a.email?a.email.includes("@")?a.password?a.password.length<6?"Password must be at least 6 characters":a.store_id?null:"Please select a store":"Password is required":"Please enter a valid email address":"Email is required",y=async s=>{s.preventDefault();const r=b();if(r){n(r);return}m(!0),n(null);try{const t=await fetch("https://omzqjvehfhjtfrphzuax.supabase.co/functions/v1/create-manager",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9tenFqdmVoZmhqdGZycGh6dWF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NzAzMDIsImV4cCI6MjA2NjM0NjMwMn0.JLHxw99HYn0z2S0uWt6shQGlqTeQNKNagoAlbNCb0nQ"},body:JSON.stringify({email:a.email,password:a.password,store_id:a.store_id,role:"store-manager"})}),c=await t.json();if(!t.ok)throw new Error(c.error||"Failed to create manager");l("/admin/managers")}catch(t){console.error("Error creating manager:",t),n(t.message||"Failed to create manager. Please try again later.")}finally{m(!1)}};return e.jsxs("div",{className:"max-w-2xl mx-auto py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(d,{variant:"ghost",onClick:()=>l("/admin/managers"),className:"mb-4",children:[e.jsx(N,{className:"h-4 w-4 mr-2"}),"Back to Managers"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Add Store Manager"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Create a new store manager account"})]}),e.jsx(w,{children:e.jsxs("form",{onSubmit:y,children:[e.jsx(C,{children:e.jsx(I,{children:"Manager Information"})}),e.jsxs(S,{className:"space-y-4",children:[u&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative",children:[u,e.jsxs("button",{className:"absolute top-0 bottom-0 right-0 px-4 py-3",onClick:()=>n(null),children:[e.jsx("span",{className:"sr-only",children:"Dismiss"}),e.jsx("span",{className:"text-2xl",children:"Ã—"})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(h,{label:"Email Address",name:"email",type:"email",value:a.email,onChange:o,required:!0,fullWidth:!0}),e.jsx("div",{className:"absolute right-2 top-8 text-gray-400",children:e.jsx(M,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx(h,{label:"Password",name:"password",type:"password",value:a.password,onChange:o,required:!0,fullWidth:!0,helperText:"Minimum 6 characters"}),e.jsx("div",{className:"absolute right-2 top-8 text-gray-400",children:e.jsx(q,{className:"h-5 w-5"})})]}),e.jsxs("div",{className:"relative",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Assign Store"}),e.jsxs("div",{className:"relative",children:[e.jsxs("select",{name:"store_id",value:a.store_id,onChange:o,className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",required:!0,children:[e.jsx("option",{value:"",children:"Select a store"}),p.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsx("div",{className:"absolute inset-y-0 right-0 flex items-center pr-2 pointer-events-none",children:e.jsx(E,{className:"h-5 w-5"})})]})]})]}),e.jsxs("div",{className:"mt-4 bg-blue-50 border border-blue-100 rounded-md p-4",children:[e.jsx("h3",{className:"text-sm font-medium text-blue-800",children:"Important Information"}),e.jsxs("ul",{className:"mt-2 text-sm text-blue-700 list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"Store managers can only access the specific store they are assigned to"}),e.jsx("li",{children:"They cannot modify payment methods or store approval status"}),e.jsx("li",{children:"They can manage products and update store details"})]})]})]}),e.jsxs(A,{className:"flex justify-end space-x-2",children:[e.jsx(d,{type:"button",variant:"secondary",onClick:()=>l("/admin/managers"),children:"Cancel"}),e.jsx(d,{type:"submit",variant:"primary",isLoading:x,children:"Create Manager"})]})]})})]})};export{T as default};
