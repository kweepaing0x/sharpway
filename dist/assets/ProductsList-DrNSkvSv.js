import{s as n,j as e,B as w,m as T,S as I,f as O,a8 as R,a4 as F,T as $}from"./ui-components-CL-10tNC.js";import{u as B,r as a,L as S}from"./react-vendor-NfsKhbMh.js";import{P as M}from"./PriceDisplay-BLSyXYBn.js";import"./supabase-DQ7Oc2S5.js";import"./stores-BBDuH2RS.js";const W=()=>{const m=B(),[k,h]=a.useState([]),[d,j]=a.useState(!0),[u,_]=a.useState(""),[p,o]=a.useState(null),[x,C]=a.useState(""),[E,P]=a.useState([]),[z,L]=a.useState([]),[H,A]=a.useState([]);a.useState(""),a.useState(null);const[g,y]=a.useState(null),[b,v]=a.useState(null);a.useState({display_order:0,is_visible:!0,starts_at:"",ends_at:""});const f=a.useCallback(async()=>{try{const{data:s,error:t}=await n.from("product_categories").select("*").order("name");if(t)throw t;L(s||[])}catch(s){console.error("Error fetching categories:",s),o(s.message)}},[]);a.useCallback(async s=>{try{const{data:t,error:r}=await n.from("product_arrangements").select("*").eq("product_id",s).order("display_order");if(r)throw r;A(t||[])}catch(t){console.error("Error fetching arrangements:",t),o(t.message)}},[]);const c=a.useCallback(async s=>{try{j(!0);const{data:t,error:r}=await n.from("stores").select("id, name").order("name");if(r)throw r;P(t||[]);const{data:l,error:i}=await n.from("products").select(`
          *,
          stores!inner(
            id,
            name
          )
        `).order("created_at",{ascending:!1});if(i)throw i;h(l||[]),o(null)}catch(t){console.error("Error fetching data:",t),o(t.message)}finally{j(!1)}},[]);a.useEffect(()=>{(async()=>{try{const{data:{user:t},error:r}=await n.auth.getUser();if(r)throw r;if(!t){m("/admin/login");return}await c(t.id)}catch(t){console.error("Authentication error:",t),m("/admin/login")}})()},[m,c]),a.useEffect(()=>{f()},[f]);const D=async s=>{if(window.confirm("Are you sure you want to delete this product?")){v(s),o(null);try{const{error:t}=await n.from("products").delete().eq("id",s);if(t)throw t;h(r=>r.filter(l=>l.id!==s)),o(null)}catch(t){console.error("Error deleting product:",t),o(t.message);const{data:{user:r}}=await n.auth.getUser();r&&await c(r.id)}finally{v(null)}}},q=async s=>{y(s.id),o(null);try{const t=!s.in_stock,{error:r}=await n.from("products").update({in_stock:t,stock_quantity:t?1:0,updated_at:new Date().toISOString()}).eq("id",s.id);if(r)throw r;h(l=>l.map(i=>i.id===s.id?{...i,in_stock:t,stock_quantity:t?1:0,updated_at:new Date().toISOString()}:i)),o(null)}catch(t){console.error("Error updating product status:",t),o(t.message);const{data:{user:r}}=await n.auth.getUser();r&&await c(r.id)}finally{y(null)}},N=k.filter(s=>{var l;const t=s.name.toLowerCase().includes(u.toLowerCase())||s.category.toLowerCase().includes(u.toLowerCase())||((l=s.description)==null?void 0:l.toLowerCase().includes(u.toLowerCase())),r=!x||s.store_id===x;return t&&r}),U=async()=>{const{data:{user:s}}=await n.auth.getUser();s&&(await c(s.id),await f())};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"sm:flex sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Products"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage all products across your stores"})]}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsx(S,{to:"/admin/products/new",children:e.jsxs(w,{variant:"primary",children:[e.jsx(T,{className:"h-4 w-4 mr-1"}),"Add Product"]})})})]}),p&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:p}),e.jsx("button",{onClick:()=>o(null),className:"text-red-700 hover:text-red-900",children:"Ã—"})]})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsxs("div",{className:"relative rounded-md flex-grow",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(I,{className:"h-5 w-5 text-gray-400","aria-hidden":"true"})}),e.jsx("input",{type:"text",placeholder:"Search products...",className:"block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm",value:u,onChange:s=>_(s.target.value)})]}),e.jsxs("select",{value:x,onChange:s=>C(s.target.value),className:"block w-full sm:w-48 pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",children:[e.jsx("option",{value:"",children:"All Stores"}),E.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs(w,{variant:"secondary",children:[e.jsx(O,{className:"h-4 w-4 mr-1"}),"More Filters"]}),e.jsxs(w,{variant:"secondary",onClick:U,disabled:d,children:[e.jsx(R,{className:`h-4 w-4 mr-1 ${d?"animate-spin":""}`}),d?"Refreshing...":"Refresh"]})]}),d?e.jsxs("div",{className:"p-6 text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-500",children:"Loading products..."})]}):N.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:N.map(s=>e.jsxs("div",{className:"bg-white shadow-md rounded-lg overflow-hidden hover:shadow-lg transition-shadow duration-200",children:[e.jsxs("div",{className:"relative h-48 bg-gray-200",children:[s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full object-cover"}):e.jsx("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:e.jsx("span",{className:"text-gray-400",children:"No image"})}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsxs("div",{className:"flex space-x-1",children:[e.jsx(S,{to:`/admin/products/${s.id}/edit`,className:"p-1 bg-white rounded-full shadow hover:bg-gray-100",children:e.jsx(F,{className:"h-4 w-4 text-blue-600"})}),e.jsx("button",{onClick:()=>D(s.id),disabled:b===s.id,className:"p-1 bg-white rounded-full shadow hover:bg-gray-100 disabled:opacity-50",children:b===s.id?e.jsx("div",{className:"animate-spin h-4 w-4 border-b-2 border-red-600 rounded-full"}):e.jsx($,{className:"h-4 w-4 text-red-600"})})]})}),!s.in_stock&&e.jsx("div",{className:"absolute top-2 left-2",children:e.jsx("span",{className:"px-2 py-1 bg-red-500 text-white text-xs font-bold rounded",children:"Out of Stock"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 truncate",children:s.name}),e.jsx("p",{className:"text-sm text-gray-600 mt-1 line-clamp-2",children:s.description})]}),e.jsx(M,{amount:s.price})]}),e.jsxs("div",{className:"mt-3 flex justify-between items-center",children:[e.jsx("span",{className:"px-2 py-1 bg-blue-100 text-blue-800 text-xs font-medium rounded",children:s.category}),e.jsx("button",{onClick:()=>q(s),disabled:g===s.id,className:`text-sm ${g===s.id?"text-gray-500 cursor-not-allowed":s.in_stock?"text-green-600 hover:text-green-700":"text-red-600 hover:text-red-700"}`,children:g===s.id?e.jsxs("span",{className:"flex items-center",children:[e.jsx("div",{className:"animate-spin h-3 w-3 border-b-2 border-current rounded-full mr-1"}),"Updating..."]}):s.in_stock?"In Stock":"Out of Stock"})]}),e.jsxs("div",{className:"mt-2 text-sm text-gray-500",children:["Store: ",s.stores.name]})]})]},s.id))}):e.jsx("div",{className:"p-6 text-center text-gray-500",children:"No products found matching your search criteria."})]})};export{W as default};
