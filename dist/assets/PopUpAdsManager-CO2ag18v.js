import{s as c,j as e,Y as H,u as S,x as k,y as C,m as $,v as E,a5 as B,D as x,B as q,ae as R,a3 as Y,a4 as z,T as G}from"./ui-components-CL-10tNC.js";import{r as n}from"./react-vendor-NfsKhbMh.js";import"./supabase-DQ7Oc2S5.js";const V=()=>{const[u,g]=n.useState([]),[A,D]=n.useState([]),[P,_]=n.useState(!0),[f,i]=n.useState(null),[y,d]=n.useState(null),[v,j]=n.useState(!1),[m,h]=n.useState(null),[b,N]=n.useState(null),[s,p]=n.useState({image_url:"",link_url:"",target_page:"home",store_id:"",start_date:"",end_date:"",display_frequency:"once_per_session"});n.useEffect(()=>{w(),I()},[]);const w=async()=>{try{_(!0);const{data:r,error:t}=await c.from("pop_up_ads").select("*").order("created_at",{ascending:!1});if(t)throw t;g(r||[]),i(null)}catch(r){console.error("Error fetching ads:",r),i(r.message)}finally{_(!1)}},I=async()=>{try{const{data:r,error:t}=await c.from("stores").select("id, name").eq("is_active",!0).order("name");if(t)throw t;D(r||[])}catch(r){console.error("Error fetching stores:",r)}},o=r=>{const{name:t,value:a}=r.target;p(l=>({...l,[t]:a}))},O=r=>{p(t=>({...t,image_url:r}))},T=()=>s.image_url.trim()?s.target_page==="store"&&!s.store_id?"Store selection is required for store-specific ads":s.start_date&&s.end_date&&new Date(s.start_date)>=new Date(s.end_date)?"End date must be after start date":null:"Ad image is required",L=async r=>{r.preventDefault();const t=T();if(t){i(t);return}j(!0),i(null),d(null);try{const a={image_url:s.image_url.trim(),link_url:s.link_url.trim()||null,target_page:s.target_page,store_id:s.target_page==="store"?s.store_id:null,start_date:s.start_date||new Date().toISOString(),end_date:s.end_date||null,display_frequency:s.display_frequency};if(m){const{error:l}=await c.from("pop_up_ads").update(a).eq("id",m);if(l)throw l;d("Pop-up ad updated successfully"),h(null)}else{const{error:l}=await c.from("pop_up_ads").insert([a]);if(l)throw l;d("Pop-up ad created successfully")}p({image_url:"",link_url:"",target_page:"home",store_id:"",start_date:"",end_date:"",display_frequency:"once_per_session"}),w()}catch(a){console.error("Error saving ad:",a),i(a.message)}finally{j(!1)}},U=r=>{p({image_url:r.image_url,link_url:r.link_url||"",target_page:r.target_page,store_id:r.store_id||"",start_date:r.start_date?new Date(r.start_date).toISOString().slice(0,16):"",end_date:r.end_date?new Date(r.end_date).toISOString().slice(0,16):"",display_frequency:r.display_frequency}),h(r.id)},F=async(r,t)=>{try{const{error:a}=await c.from("pop_up_ads").update({is_active:!t}).eq("id",r);if(a)throw a;g(u.map(l=>l.id===r?{...l,is_active:!t}:l)),d(`Pop-up ad ${t?"deactivated":"activated"} successfully`)}catch(a){console.error("Error toggling ad status:",a),i(a.message)}},M=async r=>{if(window.confirm("Are you sure you want to delete this pop-up ad?")){N(r),i(null),d(null);try{const{error:t}=await c.from("pop_up_ads").delete().eq("id",r);if(t)throw t;d("Pop-up ad deleted successfully"),g(u.filter(a=>a.id!==r))}catch(t){console.error("Error deleting ad:",t),i(t.message)}finally{N(null)}}},W=()=>{h(null),p({image_url:"",link_url:"",target_page:"home",store_id:"",start_date:"",end_date:"",display_frequency:"once_per_session"})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Pop-up Ads Manager"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage pop-up advertisements that appear on the home page and store pages."})]}),f&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative flex items-center",children:[e.jsx(H,{className:"h-5 w-5 mr-2"}),f]}),y&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded relative",children:y}),e.jsxs(S,{children:[e.jsx(k,{children:e.jsxs(C,{className:"flex items-center",children:[e.jsx($,{className:"h-5 w-5 mr-2"}),m?"Edit Pop-up Ad":"Add New Pop-up Ad"]})}),e.jsx(E,{children:e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Ad Image"}),e.jsx(B,{value:s.image_url,onChange:O,onError:i,bucket:"mall-images",folder:"ads"})]}),e.jsx(x,{label:"Link URL (Optional)",name:"link_url",type:"url",value:s.link_url,onChange:o,placeholder:"https://example.com",fullWidth:!0,helperText:"Where users will be redirected when they click the ad"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Page"}),e.jsxs("select",{name:"target_page",value:s.target_page,onChange:o,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"home",children:"Home Page"}),e.jsx("option",{value:"store",children:"Specific Store"})]})]}),s.target_page==="store"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Store"}),e.jsxs("select",{name:"store_id",value:s.store_id,onChange:o,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Choose a store..."}),A.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Display Frequency"}),e.jsxs("select",{name:"display_frequency",value:s.display_frequency,onChange:o,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"once_per_session",children:"Once per session"}),e.jsx("option",{value:"every_visit",children:"Every visit"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsx(x,{label:"Start Date (Optional)",name:"start_date",type:"datetime-local",value:s.start_date,onChange:o,fullWidth:!0}),e.jsx(x,{label:"End Date (Optional)",name:"end_date",type:"datetime-local",value:s.end_date,onChange:o,fullWidth:!0})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(q,{type:"submit",variant:"primary",disabled:v,children:v?"Saving...":m?"Update Ad":"Create Ad"}),m&&e.jsx(q,{type:"button",variant:"secondary",onClick:W,children:"Cancel"})]})]})})]}),e.jsxs(S,{children:[e.jsx(k,{children:e.jsxs(C,{children:["Active Pop-up Ads (",u.length,")"]})}),e.jsx(E,{children:P?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):u.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No pop-up ads created yet"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:u.map(r=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"aspect-video bg-gray-100 rounded-md overflow-hidden",children:e.jsx("img",{src:r.image_url,alt:"Ad preview",className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${r.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:r.is_active?"Active":"Inactive"}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:r.target_page==="home"?"Home Page":"Store Page"})]}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("p",{children:["Frequency: ",r.display_frequency.replace("_"," ")]}),r.link_url&&e.jsxs("p",{className:"truncate",children:["Link: ",r.link_url]}),e.jsxs("p",{children:["Created: ",new Date(r.created_at).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>F(r.id,r.is_active),className:`p-2 rounded-md ${r.is_active?"text-red-600 hover:bg-red-50":"text-green-600 hover:bg-green-50"}`,title:r.is_active?"Deactivate":"Activate",children:r.is_active?e.jsx(R,{className:"h-4 w-4"}):e.jsx(Y,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>U(r),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-md",title:"Edit",children:e.jsx(z,{className:"h-4 w-4"})})]}),e.jsx("button",{onClick:()=>M(r.id),disabled:b===r.id,className:"p-2 text-red-600 hover:bg-red-50 rounded-md",title:"Delete",children:b===r.id?e.jsx("div",{className:"animate-spin h-4 w-4 border-b-2 border-red-500 rounded-full"}):e.jsx(G,{className:"h-4 w-4"})})]})]})},r.id))})})]})]})};export{V as default};
