import{j as e,B as j,A as H,u as L,x as W,y as z,v as R,D as c,a5 as D,a6 as J,s as v}from"./ui-components-CL-10tNC.js";import{u as B,r as m}from"./react-vendor-NfsKhbMh.js";import{a as F}from"./index-DNL726t5.js";import"./supabase-DQ7Oc2S5.js";const O=["Luxury","Business","Budget","Boutique","Resort","Other"],Y=()=>{const g=B(),[U,y]=m.useState(!1),[w,u]=m.useState(null),[x,q]=m.useState(!0),[C,N]=m.useState(!1),d=m.useRef(null),{isSuperAdmin:f}=F(),[t,p]=m.useState({name:"",description:"",logo_url:"",location:"",category:"",telegram_contact:"",phone_number:"",channel_url:"",username:""}),[s,b]=m.useState({create_manager:!1,manager_email:"",manager_password:""});m.useEffect(()=>(f&&b(r=>({...r,create_manager:!0})),()=>{d.current&&clearTimeout(d.current)}),[f]);const A=r=>r.toLowerCase().replace(/[^a-z0-9]/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,""),_=async r=>{if(!r)return!0;N(!0);try{const{data:a,error:l}=await v.from("hotels").select("username").eq("username",r).maybeSingle(),o=!a;return q(o),l&&l.code!=="PGRST116"?(console.error("Error checking username:",l),!0):o}catch(a){return console.error("Error checking username:",a),!0}finally{N(!1)}},k=r=>{d.current&&clearTimeout(d.current),d.current=setTimeout(()=>{_(r)},300)},n=r=>{const{name:a,value:l,type:o}=r.target;if(o==="checkbox"){const i=r.target;a==="create_manager"&&b(h=>({...h,[a]:i.checked}))}else if(a.startsWith("manager_"))b(i=>({...i,[a]:l}));else{if(p(i=>({...i,[a]:l})),a==="name"){const i=A(l);p(h=>({...h,username:i})),k(i)}a==="username"&&k(l)}},E=r=>{p(a=>({...a,logo_url:r}))},S=()=>{if(!t.name.trim())return"Hotel name is required";if(!t.username.trim())return"Username is required";if(!x)return"Username is not available, please choose another one";if(C)return"Please wait while we check username availability";if(!t.category)return"Category is required";if(!t.location.trim())return"Location is required";if(!t.telegram_contact.trim())return"Telegram contact is required";if(s.create_manager){if(!s.manager_email)return"Manager email is required";if(!s.manager_password)return"Manager password is required";if(s.manager_password.length<6)return"Manager password must be at least 6 characters"}return null},M=async r=>{try{const a=await fetch("https://omzqjvehfhjtfrphzuax.supabase.co/functions/v1/create-hotel-manager",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9tenFqdmVoZmhqdGZycGh6dWF4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTA3NzAzMDIsImV4cCI6MjA2NjM0NjMwMn0.JLHxw99HYn0z2S0uWt6shQGlqTeQNKNagoAlbNCb0nQ"},body:JSON.stringify({email:s.manager_email,password:s.manager_password,hotel_id:r})});if(!a.ok){const l=await a.json();throw new Error(l.error||"Failed to create manager")}return await a.json()}catch(a){throw console.error("Error in createHotelManager:",a),a}},T=async r=>{r.preventDefault(),u(null);const a=S();if(a){u(a);return}if(!await _(t.username)){u("Username is not available. Please choose a different one.");return}y(!0);try{const{data:{user:o},error:i}=await v.auth.getUser();if(i)throw new Error("Authentication error");if(!o){g("/admin/login",{replace:!0});return}const{data:h,error:I}=await v.from("hotels").insert([{...t,owner_id:o.id,is_active:!0,approval_status:"approved"}]).select().single();if(I)throw I;s.create_manager&&await M(h.id),g("/admin/hotels")}catch(o){console.error("Error creating hotel:",o),u(o.message)}finally{y(!1)}};return e.jsxs("div",{className:"max-w-2xl mx-auto py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(j,{variant:"ghost",onClick:()=>g("/admin/hotels"),className:"mb-4",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Back to Hotels"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Create New Hotel"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Add a new hotel to your system"})]}),e.jsx(L,{children:e.jsxs("form",{onSubmit:T,children:[e.jsx(W,{children:e.jsx(z,{children:"Hotel Information"})}),e.jsxs(R,{className:"space-y-4",children:[w&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative",children:w}),e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsx(c,{label:"Hotel Name",name:"name",value:t.name,onChange:n,required:!0,fullWidth:!0}),e.jsxs("div",{className:"relative",children:[e.jsx(c,{label:"Username",name:"username",value:t.username,onChange:n,required:!0,fullWidth:!0,helperText:C?"Checking availability...":t.username?x?"Username is available":"Username is not available":"Username will be used in your hotel URL",error:t.username&&!x?"This username is already taken":void 0}),t.username&&e.jsxs("p",{className:"mt-1 text-sm text-gray-500",children:["Your hotel URL will be: /hotel/",t.username]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Hotel Logo"}),e.jsx(D,{value:t.logo_url,onChange:E,onError:u,bucket:"mall-images",folder:"hotels"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{name:"category",value:t.category,onChange:n,className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",required:!0,children:[e.jsx("option",{value:"",children:"Select a category"}),O.map(r=>e.jsx("option",{value:r,children:r},r))]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",value:t.description,onChange:n,rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{label:"Location",name:"location",value:t.location,onChange:n,required:!0,fullWidth:!0}),e.jsx(c,{label:"Phone Number",name:"phone_number",value:t.phone_number,onChange:n,fullWidth:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(c,{label:"Telegram Contact",name:"telegram_contact",value:t.telegram_contact,onChange:n,required:!0,fullWidth:!0,placeholder:"@username"}),e.jsx(c,{label:"Channel URL",name:"channel_url",value:t.channel_url,onChange:n,fullWidth:!0,placeholder:"https://t.me/channel"})]}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mt-6",children:"Manager Account"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:"create_manager",checked:s.create_manager,onChange:n,className:"h-4 w-4 text-blue-600 border-gray-300 rounded",disabled:f}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:"Create Manager Account"})]}),s.create_manager&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-2",children:[e.jsx(c,{label:"Manager Email",name:"manager_email",type:"email",value:s.manager_email,onChange:n,required:!0,fullWidth:!0}),e.jsx(c,{label:"Manager Password",name:"manager_password",type:"password",value:s.manager_password,onChange:n,required:!0,fullWidth:!0})]})]})]}),e.jsxs(J,{className:"flex justify-end space-x-2",children:[e.jsx(j,{type:"button",variant:"secondary",onClick:()=>g("/admin/hotels"),children:"Cancel"}),e.jsx(j,{type:"submit",variant:"primary",isLoading:U,className:"bg-blue-600 hover:bg-blue-700",children:"Create Hotel"})]})]})})]})};export{Y as default};
