import{s as c,j as e,z as v,u as _,x as F,y as U,m as D,v as C,D as k,B as q,T as I}from"./ui-components-CL-10tNC.js";import{r as l}from"./react-vendor-NfsKhbMh.js";import"./supabase-DQ7Oc2S5.js";const M=()=>{const[d,o]=l.useState([]),[A,u]=l.useState(!0),[x,a]=l.useState(null),[h,i]=l.useState(null),[g,f]=l.useState(!1),[p,y]=l.useState(null),[n,j]=l.useState({telegram_username:"",comment:""});l.useEffect(()=>{N()},[]);const N=async()=>{try{u(!0);const{data:r,error:s}=await c.from("fraud_list").select("*").order("created_at",{ascending:!1});if(s)throw s;o(r||[]),a(null)}catch(r){console.error("Error fetching fraud users:",r),a(r.message)}finally{u(!1)}},w=r=>{const{name:s,value:t}=r.target;j(m=>({...m,[s]:t}))},S=()=>n.telegram_username.trim()?n.comment.trim()?null:"Comment is required":"Telegram username is required",T=async r=>{r.preventDefault();const s=S();if(s){a(s);return}f(!0),a(null),i(null);try{const t=n.telegram_username.replace("@",""),{data:m}=await c.from("fraud_list").select("id").eq("telegram_username",t).maybeSingle();if(m){a("This Telegram username is already in the fraud list");return}const{error:b}=await c.from("fraud_list").insert([{telegram_username:t,comment:n.comment.trim()}]);if(b)throw b;i("Fraud user added successfully"),j({telegram_username:"",comment:""}),N()}catch(t){console.error("Error adding fraud user:",t),a(t.message)}finally{f(!1)}},E=async r=>{if(window.confirm("Are you sure you want to remove this user from the fraud list?")){y(r),a(null),i(null);try{const{error:s}=await c.from("fraud_list").delete().eq("id",r);if(s)throw s;i("Fraud user removed successfully"),o(d.filter(t=>t.id!==r))}catch(s){console.error("Error deleting fraud user:",s),a(s.message)}finally{y(null)}}};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Fraud List Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage the list of fraudulent Telegram users. When these users place orders, stores will receive notifications."})]}),x&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative flex items-center",children:[e.jsx(v,{className:"h-5 w-5 mr-2"}),x]}),h&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded relative",children:h}),e.jsxs(_,{children:[e.jsx(F,{children:e.jsxs(U,{className:"flex items-center",children:[e.jsx(D,{className:"h-5 w-5 mr-2"}),"Add Fraud User"]})}),e.jsx(C,{children:e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsx(k,{label:"Telegram Username",name:"telegram_username",value:n.telegram_username,onChange:w,placeholder:"@username or username",required:!0,fullWidth:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Comment"}),e.jsx("textarea",{name:"comment",value:n.comment,onChange:w,placeholder:"Reason for adding to fraud list...",rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]})]}),e.jsx(q,{type:"submit",variant:"primary",disabled:g,className:"bg-red-600 hover:bg-red-700",children:g?"Adding...":"Add to Fraud List"})]})})]}),e.jsxs(_,{children:[e.jsx(F,{children:e.jsxs(U,{children:["Fraud Users (",d.length,")"]})}),e.jsx(C,{children:A?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):d.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No fraud users in the list"})}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Telegram Username"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Comment"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Added Date"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:d.map(r=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"h-5 w-5 text-red-500 mr-2"}),e.jsxs("span",{className:"text-sm font-medium text-gray-900",children:["@",r.telegram_username]})]})}),e.jsx("td",{className:"px-6 py-4",children:e.jsx("div",{className:"text-sm text-gray-900 max-w-xs",children:r.comment})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:r.created_at?new Date(r.created_at).toLocaleDateString():"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsx("button",{onClick:()=>E(r.id),disabled:p===r.id,className:"text-red-600 hover:text-red-900",title:"Remove from fraud list",children:p===r.id?e.jsx("div",{className:"animate-spin h-5 w-5 border-b-2 border-red-500 rounded-full"}):e.jsx(I,{className:"h-5 w-5"})})})]},r.id))})]})})})]})]})};export{M as default};
