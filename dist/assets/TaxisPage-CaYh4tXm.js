import{s as P,j as e,S as T,X as m,B as q,P as $,g as D,f as H}from"./ui-components-CL-10tNC.js";import{r as a}from"./react-vendor-NfsKhbMh.js";import{B as J}from"./BottomNavigation-BMDl6fTq.js";import{F as U,S as X,a as G}from"./FilterDrawer-D0ALiK1_.js";import{a as K,o as Q}from"./telegram-BI51GiG9.js";import"./supabase-DQ7Oc2S5.js";import"./index-DNL726t5.js";const re=()=>{const[v,L]=a.useState([]),[O,y]=a.useState(!0),[i,d]=a.useState(""),[n,A]=a.useState(""),[r,h]=a.useState("all"),[c,x]=a.useState(""),[l,p]=a.useState(!1),[F,R]=a.useState([]),[M,u]=a.useState(!1),[z,N]=a.useState(!1),[b,f]=a.useState([]);a.useEffect(()=>{const t=setTimeout(()=>{A(i)},300);return()=>clearTimeout(t)},[i]),a.useEffect(()=>{const t=localStorage.getItem("taxi_recent_searches");t&&f(JSON.parse(t))},[]);const w=a.useCallback(t=>{if(!t.trim())return;const s=[t,...b.filter(o=>o!==t)].slice(0,5);f(s),localStorage.setItem("taxi_recent_searches",JSON.stringify(s))},[b]),S=a.useCallback(async()=>{try{y(!0);const{data:t,error:s}=await P.from("taxis").select("*").eq("is_active",!0).eq("approval_status","approved").order("display_order",{ascending:!0,nullsLast:!0}).order("driver_name");if(s)throw s;if(L(t||[]),t&&t.length>0){const o=Array.from(new Set(t.map(j=>j.location))).filter(Boolean).sort();R(o)}}catch(t){console.error("Error fetching taxis:",t)}finally{y(!1)}},[]);a.useEffect(()=>{S()},[S]);const C=a.useMemo(()=>v.filter(t=>{var k;const s=t.driver_name.toLowerCase().includes(n.toLowerCase())||((k=t.description)==null?void 0:k.toLowerCase().includes(n.toLowerCase())),o=r==="all"||t.vehicle_type===r,j=!c||t.location===c,V=!l||t.availability_status;return s&&o&&j&&V}),[v,n,r,c,l]),g=a.useMemo(()=>{let t=0;return r!=="all"&&t++,c&&t++,l&&t++,t},[r,c,l]),B=t=>{window.location.href=`tel:${t}`},E=t=>{const s=K(t.driver_name,t.vehicle_type,t.location);Q(t.telegram_contact,s)},I=a.useCallback(t=>{d(t),t.trim()&&w(t)},[w]),_=()=>{h("all"),x(""),p(!1)};return e.jsxs("div",{className:"min-h-screen bg-theme-primary pb-20",children:[e.jsx("div",{className:"sticky top-0 z-40 bg-theme-card border-b border-theme shadow-lg",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h1",{className:"text-2xl font-bold text-theme-primary",children:"Taxis"}),e.jsx("button",{onClick:()=>u(!0),className:"p-2.5 hover:bg-theme-tertiary rounded-full transition-colors","aria-label":"Search taxis",children:e.jsx(T,{className:"w-5 h-5 text-theme-secondary"})})]}),n&&e.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-theme-secondary",children:"Searching for:"}),e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-accent-cyan/10 border border-accent-cyan/30 rounded-full",children:[e.jsx("span",{className:"text-sm font-medium text-accent-cyan",children:n}),e.jsx("button",{onClick:()=>d(""),className:"p-0.5 hover:bg-accent-cyan/20 rounded-full transition-colors",children:e.jsx(m,{className:"w-3.5 h-3.5 text-accent-cyan"})})]})]}),g>0&&e.jsxs("div",{className:"mt-3 flex flex-wrap gap-2",children:[r!=="all"&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-accent-purple/10 border border-accent-purple/30 rounded-full",children:[e.jsx("span",{className:"text-sm font-medium text-accent-purple capitalize",children:r}),e.jsx("button",{onClick:()=>h("all"),className:"p-0.5 hover:bg-accent-purple/20 rounded-full transition-colors",children:e.jsx(m,{className:"w-3.5 h-3.5 text-accent-purple"})})]}),c&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-accent-purple/10 border border-accent-purple/30 rounded-full",children:[e.jsx("span",{className:"text-sm font-medium text-accent-purple",children:c}),e.jsx("button",{onClick:()=>x(""),className:"p-0.5 hover:bg-accent-purple/20 rounded-full transition-colors",children:e.jsx(m,{className:"w-3.5 h-3.5 text-accent-purple"})})]}),l&&e.jsxs("div",{className:"flex items-center gap-2 px-3 py-1.5 bg-accent-green/10 border border-accent-green/30 rounded-full",children:[e.jsx("span",{className:"text-sm font-medium text-accent-green",children:"Available Only"}),e.jsx("button",{onClick:()=>p(!1),className:"p-0.5 hover:bg-accent-green/20 rounded-full transition-colors",children:e.jsx(m,{className:"w-3.5 h-3.5 text-accent-green"})})]})]})]})}),e.jsx("div",{className:"max-w-7xl mx-auto px-4 py-6",children:O?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-accent-cyan"})}):C.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(T,{className:"h-16 w-16 text-theme-tertiary mx-auto mb-4"}),e.jsx("p",{className:"text-theme-secondary text-lg mb-4",children:"No taxis found"}),(i||g>0)&&e.jsx(q,{variant:"secondary",onClick:()=>{d(""),_()},className:"mx-auto bg-accent-cyan hover:bg-accent-cyan/90 text-black",children:"Clear all filters"})]}):e.jsx("div",{className:"space-y-4",children:C.map(t=>e.jsxs("div",{className:"bg-theme-card rounded-2xl border border-theme overflow-hidden transition-all duration-300 hover:border-accent-cyan/50 hover:shadow-lg hover:shadow-accent-cyan/10",children:[e.jsxs("div",{className:"p-4 flex items-center gap-4",children:[e.jsxs("div",{className:"relative flex-shrink-0",children:[t.photo_url?e.jsx("img",{src:t.photo_url,alt:t.driver_name,className:"w-20 h-20 rounded-xl object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-xl bg-gradient-to-br from-accent-orange/20 to-accent-cyan/20 flex items-center justify-center border border-accent-cyan/30",children:e.jsx("span",{className:"text-2xl font-bold text-accent-cyan",children:t.driver_name.substring(0,2).toUpperCase()})}),e.jsx("div",{className:`absolute -bottom-1 -right-1 w-6 h-6 rounded-full border-2 border-theme-card ${t.availability_status?"bg-accent-green glow-green":"bg-theme-tertiary"}`,title:t.availability_status?"Available":"Unavailable"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h3",{className:"text-lg font-semibold text-theme-primary mb-1",children:t.driver_name}),e.jsx("span",{className:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-accent-purple/20 border border-accent-purple/30 text-accent-purple capitalize mb-2",children:t.vehicle_type}),t.description&&e.jsx("p",{className:"text-sm text-theme-secondary line-clamp-1 mb-2",children:t.description}),e.jsxs("div",{className:"flex items-center text-sm text-theme-tertiary",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),t.location]})]})]}),e.jsxs("div",{className:"flex gap-2 px-4 pb-4",children:[e.jsxs("button",{onClick:()=>B(t.phone_number),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-theme-tertiary hover:bg-accent-orange/20 border border-accent-orange/30 text-accent-orange rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-95",children:[e.jsx($,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Call"})]}),e.jsxs("button",{onClick:()=>E(t),className:"flex-1 flex items-center justify-center gap-2 px-4 py-2.5 bg-accent-cyan hover:bg-accent-cyan/90 text-black rounded-xl transition-all duration-200 hover:scale-[1.02] active:scale-95 glow-cyan",children:[e.jsx(D,{className:"h-4 w-4"}),e.jsx("span",{className:"font-medium",children:"Message"})]})]})]},t.id))})}),e.jsx(U,{icon:e.jsx(H,{className:"w-6 h-6"}),onClick:()=>N(!0),label:"Filters",color:"purple",badge:g}),e.jsx(X,{isOpen:M,onClose:()=>u(!1),searchValue:i,onSearchChange:I,placeholder:"Search taxis by name or description...",recentSearches:b,onRecentSearchClick:t=>{d(t),u(!1)},onClearRecent:()=>{f([]),localStorage.removeItem("taxi_recent_searches")}}),e.jsx(G,{isOpen:z,onClose:()=>N(!1),onApply:()=>{},onReset:_,title:"Filter Taxis",children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-theme-primary mb-3",children:"Vehicle Type"}),e.jsx("div",{className:"grid grid-cols-3 gap-3",children:["all","motorcycle","car"].map(t=>e.jsx("button",{onClick:()=>h(t),className:`
                    px-4 py-3 rounded-xl text-sm font-medium capitalize transition-all duration-200
                    ${r===t?"bg-accent-purple text-white glow-purple":"bg-theme-tertiary text-theme-secondary hover:bg-theme-tertiary/80"}
                  `,children:t},t))})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-semibold text-theme-primary mb-3",children:"Location"}),e.jsxs("select",{value:c,onChange:t=>x(t.target.value),className:"w-full px-4 py-3 bg-theme-input border border-theme rounded-xl text-theme-primary focus:outline-none focus:ring-2 focus:ring-accent-purple focus:border-transparent",children:[e.jsx("option",{value:"",children:"All Locations"}),F.map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsx("div",{children:e.jsxs("label",{className:"flex items-center gap-3 px-4 py-3 bg-theme-tertiary rounded-xl cursor-pointer hover:bg-theme-tertiary/80 transition-colors",children:[e.jsx("input",{type:"checkbox",checked:l,onChange:t=>p(t.target.checked),className:"w-5 h-5 rounded bg-theme-input border-theme text-accent-green focus:ring-2 focus:ring-accent-green"}),e.jsx("span",{className:"text-sm font-medium text-theme-primary",children:"Show only available taxis"})]})})]})}),e.jsx(J,{})]})};export{re as default};
