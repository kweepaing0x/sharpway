import{j as e,B as j,ah as P,m as A,X as D,a4 as _,T as B,s as z}from"./ui-components-CL-10tNC.js";import{r as c}from"./react-vendor-NfsKhbMh.js";import"./supabase-DQ7Oc2S5.js";const L=()=>{const[u,h]=c.useState([]),[p,g]=c.useState([]),[w,v]=c.useState(!0),[b,l]=c.useState(null),[n,f]=c.useState(null),[i,d]=c.useState(null),m=async(r,t)=>{const{data:{session:o}}=await z.auth.getSession(),s=o==null?void 0:o.access_token,a=`https://omzqjvehfhjtfrphzuax.supabase.co/functions/v1/${r}`,E={"Content-Type":"application/json",Authorization:s?`Bearer ${s}`:"",...t.headers||{}},y=await fetch(a,{...t,headers:E});if(!y.ok){const T=await y.json();throw new Error(T.error||"Something went wrong")}return y.json()};c.useEffect(()=>{(async()=>{try{const t=await m("store-category-manager",{method:"GET"});h(t||[]);const o=await m("product-category-manager",{method:"GET"});g(o||[]),l(null)}catch(t){console.error("Error fetching categories:",t),l(t.message)}finally{v(!1)}})()},[]);const C=async()=>{if(i)try{const r=i.type==="store"?"store-category-manager":"product-category-manager",t=await m(r,{method:"POST",body:JSON.stringify({name:i.name,description:i.description,is_active:!0})});i.type==="store"?h([...u,t[0]]):g([...p,t[0]]),d(null),l(null)}catch(r){console.error("Error creating category:",r),l(r.message)}},x=async(r,t,o)=>{try{await m(t==="store"?"store-category-manager":"product-category-manager",{method:"PUT",body:JSON.stringify({id:r,...o})}),t==="store"?h(u.map(a=>a.id===r?{...a,...o}:a)):g(p.map(a=>a.id===r?{...a,...o}:a)),f(null),l(null)}catch(s){console.error("Error updating category:",s),l(s.message)}},S=async(r,t)=>{if(window.confirm("Are you sure you want to delete this category?"))try{await m(t==="store"?"store-category-manager":"product-category-manager",{method:"DELETE",body:JSON.stringify({id:r})}),t==="store"?h(u.filter(s=>s.id!==r)):g(p.filter(s=>s.id!==r)),l(null)}catch(o){console.error("Error deleting category:",o),l(o.message)}},k=async(r,t)=>{await x(r.id,t,{is_active:!r.is_active})},N=({categories:r,type:t,title:o})=>e.jsxs("div",{className:"bg-white shadow-md overflow-hidden sm:rounded-md",children:[e.jsx("div",{className:"px-6 py-4 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:o}),e.jsxs(j,{variant:"primary",onClick:()=>d({name:"",description:"",type:t}),className:"text-sm",children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"Add ",t==="store"?"Store":"Product"," Category"]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Description"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:r.length===0?e.jsx("tr",{children:e.jsxs("td",{colSpan:4,className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500 text-center",children:["No ",t," categories found."]})}):r.map(s=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:(n==null?void 0:n.id)===s.id&&(n==null?void 0:n.type)===t?e.jsx("input",{type:"text",defaultValue:s.name,className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",onBlur:a=>x(s.id,t,{name:a.target.value}),onKeyPress:a=>{a.key==="Enter"&&x(s.id,t,{name:a.currentTarget.value})},autoFocus:!0}):e.jsx("div",{className:"text-sm font-medium text-gray-900",children:s.name})}),e.jsx("td",{className:"px-6 py-4",children:(n==null?void 0:n.id)===s.id&&(n==null?void 0:n.type)===t?e.jsx("input",{type:"text",defaultValue:s.description||"",className:"w-full px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-1 focus:ring-blue-500",onBlur:a=>x(s.id,t,{description:a.target.value}),onKeyPress:a=>{a.key==="Enter"&&x(s.id,t,{description:a.currentTarget.value})}}):e.jsx("div",{className:"text-sm text-gray-500",children:s.description||"-"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("button",{onClick:()=>k(s,t),className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${s.is_active?"bg-green-100 text-green-800 hover:bg-green-200":"bg-red-100 text-red-800 hover:bg-red-200"}`,children:s.is_active?"Active":"Inactive"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex justify-end space-x-2",children:[(n==null?void 0:n.id)===s.id&&(n==null?void 0:n.type)===t?e.jsx("button",{onClick:()=>f(null),className:"text-gray-600 hover:text-gray-900",title:"Cancel",children:e.jsx(D,{className:"h-5 w-5"})}):e.jsx("button",{onClick:()=>f({id:s.id,type:t}),className:"text-indigo-600 hover:text-indigo-900",title:"Edit",children:e.jsx(_,{className:"h-5 w-5"})}),e.jsx("button",{onClick:()=>S(s.id,t),className:"text-red-600 hover:text-red-900",title:"Delete",children:e.jsx(B,{className:"h-5 w-5"})})]})})]},s.id))})]})})]});return w?e.jsxs("div",{className:"flex justify-center items-center h-screen",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"}),e.jsx("p",{className:"ml-4 text-gray-500",children:"Loading categories..."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Categories Management"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage store and product categories"})]}),b&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative",children:b}),i&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsx("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:e.jsxs("div",{className:"mt-3",children:[e.jsxs("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:["Add New ",i.type==="store"?"Store":"Product"," Category"]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Name"}),e.jsx("input",{type:"text",value:i.name,onChange:r=>d({...i,name:r.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Category name"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Description"}),e.jsx("textarea",{value:i.description,onChange:r=>d({...i,description:r.target.value}),className:"mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-blue-500 focus:border-blue-500",placeholder:"Category description (optional)",rows:3})]})]}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[e.jsx(j,{variant:"secondary",onClick:()=>d(null),children:"Cancel"}),e.jsxs(j,{variant:"primary",onClick:C,disabled:!i.name.trim(),children:[e.jsx(P,{className:"h-4 w-4 mr-1"}),"Create Category"]})]})]})})}),e.jsx(N,{categories:u,type:"store",title:"Store Categories"}),e.jsx(N,{categories:p,type:"product",title:"Product Categories"})]})};export{L as default};
