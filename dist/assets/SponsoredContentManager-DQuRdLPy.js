import{s as x,j as e,e as U,u as k,x as S,y as C,m as M,v as D,D as h,a5 as $,B as E,ae as B,a3 as F,a4 as P,T as H}from"./ui-components-CL-10tNC.js";import{r as l}from"./react-vendor-NfsKhbMh.js";import"./supabase-DQ7Oc2S5.js";const K=()=>{const[i,p]=l.useState([]),[I,_]=l.useState(!0),[b,n]=l.useState(null),[y,o]=l.useState(null),[f,v]=l.useState(!1),[c,m]=l.useState(null),[j,N]=l.useState(null),[a,u]=l.useState({title:"",image_url:"",redirect_url:"",display_order:0,start_date:"",end_date:""});l.useEffect(()=>{w()},[]);const w=async()=>{try{_(!0);const{data:r,error:t}=await x.from("sponsored_content").select("*").order("display_order",{ascending:!0});if(t)throw t;p(r||[]),n(null)}catch(r){console.error("Error fetching sponsored content:",r),n(r.message)}finally{_(!1)}},g=r=>{const{name:t,value:s}=r.target;u(d=>({...d,[t]:t==="display_order"?parseInt(s)||0:s}))},q=r=>{u(t=>({...t,image_url:r}))},O=()=>a.title.trim()?a.image_url.trim()?a.redirect_url.trim()?a.start_date&&a.end_date&&new Date(a.start_date)>=new Date(a.end_date)?"End date must be after start date":null:"Redirect URL is required":"Image is required":"Title is required",T=async r=>{r.preventDefault();const t=O();if(t){n(t);return}v(!0),n(null),o(null);try{const s={title:a.title.trim(),image_url:a.image_url.trim(),redirect_url:a.redirect_url.trim(),display_order:a.display_order,start_date:a.start_date||new Date().toISOString(),end_date:a.end_date||null};if(c){const{error:d}=await x.from("sponsored_content").update(s).eq("id",c);if(d)throw d;o("Sponsored content updated successfully"),m(null)}else{const{error:d}=await x.from("sponsored_content").insert([s]);if(d)throw d;o("Sponsored content created successfully")}u({title:"",image_url:"",redirect_url:"",display_order:0,start_date:"",end_date:""}),w()}catch(s){console.error("Error saving sponsored content:",s),n(s.message)}finally{v(!1)}},A=r=>{u({title:r.title,image_url:r.image_url,redirect_url:r.redirect_url,display_order:r.display_order,start_date:r.start_date?new Date(r.start_date).toISOString().slice(0,16):"",end_date:r.end_date?new Date(r.end_date).toISOString().slice(0,16):""}),m(r.id)},L=async(r,t)=>{try{const{error:s}=await x.from("sponsored_content").update({is_active:!t}).eq("id",r);if(s)throw s;p(i.map(d=>d.id===r?{...d,is_active:!t}:d)),o(`Sponsored content ${t?"deactivated":"activated"} successfully`)}catch(s){console.error("Error toggling status:",s),n(s.message)}},W=async r=>{if(window.confirm("Are you sure you want to delete this sponsored content?")){N(r),n(null),o(null);try{const{error:t}=await x.from("sponsored_content").delete().eq("id",r);if(t)throw t;o("Sponsored content deleted successfully"),p(i.filter(s=>s.id!==r))}catch(t){console.error("Error deleting sponsored content:",t),n(t.message)}finally{N(null)}}},R=()=>{m(null),u({title:"",image_url:"",redirect_url:"",display_order:0,start_date:"",end_date:""})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Sponsored Content Manager"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Manage featured carousel content that appears on the home page."})]}),b&&e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 text-red-700 dark:text-red-300 px-4 py-3 rounded relative flex items-center",children:[e.jsx(U,{className:"h-5 w-5 mr-2"}),b]}),y&&e.jsx("div",{className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 text-green-700 dark:text-green-300 px-4 py-3 rounded relative",children:y}),e.jsxs(k,{children:[e.jsx(S,{children:e.jsxs(C,{className:"flex items-center",children:[e.jsx(M,{className:"h-5 w-5 mr-2"}),c?"Edit Sponsored Content":"Add New Sponsored Content"]})}),e.jsx(D,{children:e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsx(h,{label:"Title",name:"title",type:"text",value:a.title,onChange:g,placeholder:"Enter content title",required:!0,fullWidth:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1",children:"Content Image"}),e.jsx($,{value:a.image_url,onChange:q,onError:n,bucket:"mall-images",folder:"sponsored"})]}),e.jsx(h,{label:"Redirect URL",name:"redirect_url",type:"url",value:a.redirect_url,onChange:g,placeholder:"https://example.com",required:!0,fullWidth:!0,helperText:"Where users will be redirected when they click the content"}),e.jsx(h,{label:"Display Order",name:"display_order",type:"number",value:a.display_order.toString(),onChange:g,placeholder:"0",fullWidth:!0,helperText:"Lower numbers appear first in the carousel"}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsx(h,{label:"Start Date (Optional)",name:"start_date",type:"datetime-local",value:a.start_date,onChange:g,fullWidth:!0}),e.jsx(h,{label:"End Date (Optional)",name:"end_date",type:"datetime-local",value:a.end_date,onChange:g,fullWidth:!0})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(E,{type:"submit",variant:"primary",disabled:f,children:f?"Saving...":c?"Update Content":"Create Content"}),c&&e.jsx(E,{type:"button",variant:"secondary",onClick:R,children:"Cancel"})]})]})})]}),e.jsxs(k,{children:[e.jsx(S,{children:e.jsxs(C,{children:["Sponsored Content (",i.length,")"]})}),e.jsx(D,{children:I?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):i.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500 dark:text-gray-400",children:"No sponsored content created yet"})}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:i.map(r=>e.jsx("div",{className:"border dark:border-gray-700 rounded-lg p-4 hover:bg-gray-50 dark:hover:bg-gray-800/50",children:e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"aspect-video bg-gray-100 dark:bg-gray-800 rounded-md overflow-hidden",children:e.jsx("img",{src:r.image_url,alt:r.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-gray-900 dark:text-white",children:r.title}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 truncate mt-1",children:r.redirect_url})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${r.is_active?"bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200":"bg-red-100 dark:bg-red-900 text-red-800 dark:text-red-200"}`,children:r.is_active?"Active":"Inactive"}),e.jsxs("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200",children:["Order: ",r.display_order]})]}),e.jsxs("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:[e.jsxs("p",{children:["Created: ",new Date(r.created_at).toLocaleDateString()]}),r.end_date&&e.jsxs("p",{children:["Expires: ",new Date(r.end_date).toLocaleDateString()]})]}),e.jsxs("div",{className:"flex items-center justify-between pt-2 border-t dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("button",{onClick:()=>L(r.id,r.is_active),className:`p-2 rounded-md ${r.is_active?"text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20":"text-green-600 hover:bg-green-50 dark:hover:bg-green-900/20"}`,title:r.is_active?"Deactivate":"Activate",children:r.is_active?e.jsx(B,{className:"h-4 w-4"}):e.jsx(F,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>A(r),className:"p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md",title:"Edit",children:e.jsx(P,{className:"h-4 w-4"})})]}),e.jsx("button",{onClick:()=>W(r.id),disabled:j===r.id,className:"p-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-md",title:"Delete",children:j===r.id?e.jsx("div",{className:"animate-spin h-4 w-4 border-b-2 border-red-500 rounded-full"}):e.jsx(H,{className:"h-4 w-4"})})]})]})},r.id))})})]})]})};export{K as default};
