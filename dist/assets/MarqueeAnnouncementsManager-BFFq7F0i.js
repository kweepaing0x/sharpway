import{s as i,j as e,W as $,u as w,x as S,y as A,m as B,v as D,D as E,B as C,ae as F,a3 as R,a4 as U,T as z}from"./ui-components-CL-10tNC.js";import{r as d}from"./react-vendor-NfsKhbMh.js";import"./supabase-DQ7Oc2S5.js";const Q=()=>{const[c,x]=d.useState([]),[q,I]=d.useState([]),[k,p]=d.useState(!0),[f,l]=d.useState(null),[_,o]=d.useState(null),[j,v]=d.useState(!1),[u,h]=d.useState(null),[b,y]=d.useState(null),[s,g]=d.useState({content:"",target_page:"home",store_id:"",start_date:"",end_date:""});d.useEffect(()=>{N(),O()},[]);const N=async()=>{try{p(!0);const{data:t,error:r}=await i.from("marquee_announcements").select("*").order("created_at",{ascending:!1});if(r)throw r;x(t||[]),l(null)}catch(t){console.error("Error fetching announcements:",t),l(t.message)}finally{p(!1)}},O=async()=>{try{const{data:t,error:r}=await i.from("stores").select("id, name").eq("is_active",!0).order("name");if(r)throw r;I(t||[])}catch(t){console.error("Error fetching stores:",t)}},m=t=>{const{name:r,value:a}=t.target;g(n=>({...n,[r]:a}))},P=()=>s.content.trim()?s.target_page==="store"&&!s.store_id?"Store selection is required for store-specific announcements":s.start_date&&s.end_date&&new Date(s.start_date)>=new Date(s.end_date)?"End date must be after start date":null:"Announcement content is required",M=async t=>{t.preventDefault();const r=P();if(r){l(r);return}v(!0),l(null),o(null);try{const a={content:s.content.trim(),target_page:s.target_page,store_id:s.target_page==="store"?s.store_id:null,start_date:s.start_date||new Date().toISOString(),end_date:s.end_date||null};if(u){const{error:n}=await i.from("marquee_announcements").update(a).eq("id",u);if(n)throw n;o("Announcement updated successfully"),h(null)}else{const{error:n}=await i.from("marquee_announcements").insert([a]);if(n)throw n;o("Announcement created successfully")}g({content:"",target_page:"home",store_id:"",start_date:"",end_date:""}),N()}catch(a){console.error("Error saving announcement:",a),l(a.message)}finally{v(!1)}},T=t=>{g({content:t.content,target_page:t.target_page,store_id:t.store_id||"",start_date:t.start_date?new Date(t.start_date).toISOString().slice(0,16):"",end_date:t.end_date?new Date(t.end_date).toISOString().slice(0,16):""}),h(t.id)},L=async(t,r)=>{try{const{error:a}=await i.from("marquee_announcements").update({is_active:!r}).eq("id",t);if(a)throw a;x(c.map(n=>n.id===t?{...n,is_active:!r}:n)),o(`Announcement ${r?"deactivated":"activated"} successfully`)}catch(a){console.error("Error toggling announcement status:",a),l(a.message)}},H=async t=>{if(window.confirm("Are you sure you want to delete this announcement?")){y(t),l(null),o(null);try{const{error:r}=await i.from("marquee_announcements").delete().eq("id",t);if(r)throw r;o("Announcement deleted successfully"),x(c.filter(a=>a.id!==t))}catch(r){console.error("Error deleting announcement:",r),l(r.message)}finally{y(null)}}},W=()=>{h(null),g({content:"",target_page:"home",store_id:"",start_date:"",end_date:""})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Marquee Announcements"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Manage scrolling announcements that appear on the home page and store pages."})]}),f&&e.jsxs("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative flex items-center",children:[e.jsx($,{className:"h-5 w-5 mr-2"}),f]}),_&&e.jsx("div",{className:"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded relative",children:_}),e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(A,{className:"flex items-center",children:[e.jsx(B,{className:"h-5 w-5 mr-2"}),u?"Edit Announcement":"Add New Announcement"]})}),e.jsx(D,{children:e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Announcement Content"}),e.jsx("textarea",{name:"content",value:s.content,onChange:m,placeholder:"Enter your announcement text...",rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Target Page"}),e.jsxs("select",{name:"target_page",value:s.target_page,onChange:m,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"home",children:"Home Page"}),e.jsx("option",{value:"store",children:"Specific Store"})]})]}),s.target_page==="store"&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Select Store"}),e.jsxs("select",{name:"store_id",value:s.store_id,onChange:m,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0,children:[e.jsx("option",{value:"",children:"Choose a store..."}),q.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsx(E,{label:"Start Date (Optional)",name:"start_date",type:"datetime-local",value:s.start_date,onChange:m,fullWidth:!0}),e.jsx(E,{label:"End Date (Optional)",name:"end_date",type:"datetime-local",value:s.end_date,onChange:m,fullWidth:!0})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(C,{type:"submit",variant:"primary",disabled:j,children:j?"Saving...":u?"Update Announcement":"Create Announcement"}),u&&e.jsx(C,{type:"button",variant:"secondary",onClick:W,children:"Cancel"})]})]})})]}),e.jsxs(w,{children:[e.jsx(S,{children:e.jsxs(A,{children:["Active Announcements (",c.length,")"]})}),e.jsx(D,{children:k?e.jsx("div",{className:"flex justify-center items-center h-32",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}):c.length===0?e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-gray-500",children:"No announcements created yet"})}):e.jsx("div",{className:"space-y-4",children:c.map(t=>e.jsx("div",{className:"border rounded-lg p-4 hover:bg-gray-50",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[e.jsx("span",{className:`px-2 py-1 text-xs font-medium rounded-full ${t.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:t.is_active?"Active":"Inactive"}),e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-blue-100 text-blue-800",children:t.target_page==="home"?"Home Page":"Store Page"})]}),e.jsx("p",{className:"text-gray-900 mb-2",children:t.content}),e.jsxs("div",{className:"text-sm text-gray-500",children:[e.jsxs("p",{children:["Created: ",new Date(t.created_at).toLocaleDateString()]}),t.start_date&&e.jsxs("p",{children:["Starts: ",new Date(t.start_date).toLocaleDateString()]}),t.end_date&&e.jsxs("p",{children:["Ends: ",new Date(t.end_date).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 ml-4",children:[e.jsx("button",{onClick:()=>L(t.id,t.is_active),className:`p-2 rounded-md ${t.is_active?"text-red-600 hover:bg-red-50":"text-green-600 hover:bg-green-50"}`,title:t.is_active?"Deactivate":"Activate",children:t.is_active?e.jsx(F,{className:"h-4 w-4"}):e.jsx(R,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>T(t),className:"p-2 text-blue-600 hover:bg-blue-50 rounded-md",title:"Edit",children:e.jsx(U,{className:"h-4 w-4"})}),e.jsx("button",{onClick:()=>H(t.id),disabled:b===t.id,className:"p-2 text-red-600 hover:bg-red-50 rounded-md",title:"Delete",children:b===t.id?e.jsx("div",{className:"animate-spin h-4 w-4 border-b-2 border-red-500 rounded-full"}):e.jsx(z,{className:"h-4 w-4"})})]})]})},t.id))})})]})]})};export{Q as default};
