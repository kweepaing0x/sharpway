import{s as g,j as e,B as p,A as E,u as P,x as I,y as D,v as L,D as h,a5 as B,a6 as F}from"./ui-components-CL-10tNC.js";import{u as O,f as A,j as H,r as o}from"./react-vendor-NfsKhbMh.js";import"./supabase-DQ7Oc2S5.js";const R=["Clothing","Electronics","Food & Beverages","Home & Living","Health & Beauty","Sports & Leisure","Books & Stationery","Services","Other"],G=()=>{const c=O(),{id:d}=A(),{store:l,storeId:u}=H(),[j,x]=o.useState(!1),[f,n]=o.useState(null),[y,v]=o.useState([]),[C,b]=o.useState(!1),[t,m]=o.useState({name:"",description:"",price:"",image_url:"",category:"",stock_quantity:"0"});o.useEffect(()=>{d&&q(),k()},[d,u]);const k=async()=>{b(!0);try{const{data:r,error:a}=await g.from("product_categories").select("*").eq("is_active",!0).order("name");if(a)throw a;v(r||[])}catch(r){console.error("Error fetching product categories:",r)}finally{b(!1)}},q=async()=>{try{const{data:r,error:a}=await g.from("products").select("*").eq("id",d).eq("store_id",u).single();if(a)throw a;if(!r)throw new Error("Product not found or you do not have permission to edit it");m({name:r.name,description:r.description||"",price:r.price.toString(),image_url:r.image_url||"",category:r.category,stock_quantity:r.stock_quantity.toString()})}catch(r){console.error("Error fetching product:",r),n(r.message),c("/store-manager/products")}},i=r=>{const{name:a,value:s}=r.target;m(w=>({...w,[a]:s}))},N=r=>{m(a=>({...a,image_url:r}))},S=()=>t.name.trim()?t.category?!t.price||parseFloat(t.price)<0?"Please enter a valid price":parseInt(t.stock_quantity)<0?"Stock quantity cannot be negative":null:"Category is required":"Product name is required",_=async r=>{r.preventDefault();const a=S();if(a){n(a);return}x(!0),n(null);try{const{error:s}=await g.from("products").update({...t,price:parseFloat(t.price),stock_quantity:parseInt(t.stock_quantity),in_stock:parseInt(t.stock_quantity)>0,updated_at:new Date().toISOString()}).eq("id",d).eq("store_id",u);if(s)throw s;c("/store-manager/products")}catch(s){console.error("Error updating product:",s),n(s.message)}finally{x(!1)}};return e.jsxs("div",{className:"max-w-2xl mx-auto py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsxs(p,{variant:"ghost",onClick:()=>c("/store-manager/products"),className:"mb-4",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Back to Products"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Product"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Update your product information"})]}),e.jsx(P,{children:e.jsxs("form",{onSubmit:_,children:[e.jsx(I,{children:e.jsx(D,{children:"Product Information"})}),e.jsxs(L,{className:"space-y-4",children:[f&&e.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative",children:f}),e.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-3 text-green-800",children:e.jsxs("p",{className:"font-medium",children:["Store: ",l==null?void 0:l.name]})}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsx(h,{label:"Product Name",name:"name",value:t.name,onChange:i,required:!0,fullWidth:!0}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),e.jsxs("select",{name:"category",value:t.category,onChange:i,className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-green-500 focus:border-green-500 sm:text-sm rounded-md",required:!0,children:[e.jsx("option",{value:"",children:"Select a category"}),C?e.jsx("option",{value:"",disabled:!0,children:"Loading categories..."}):y.length>0?y.map(r=>e.jsx("option",{value:r.id,children:r.name},r.id)):R.map(r=>e.jsx("option",{value:r,children:r},r))]})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),e.jsx("textarea",{name:"description",value:t.description,onChange:i,rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-green-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Image"}),e.jsx(B,{value:t.image_url,onChange:N,onError:n,bucket:"products",folder:"products"})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[e.jsx(h,{label:"Price",name:"price",type:"number",min:"0",step:"0.01",value:t.price,onChange:i,required:!0,fullWidth:!0}),e.jsx(h,{label:"Stock Quantity",name:"stock_quantity",type:"number",min:"0",value:t.stock_quantity,onChange:i,required:!0,fullWidth:!0})]})]}),e.jsxs(F,{className:"flex justify-end space-x-2",children:[e.jsx(p,{type:"button",variant:"secondary",onClick:()=>c("/store-manager/products"),children:"Cancel"}),e.jsx(p,{type:"submit",variant:"primary",isLoading:j,className:"bg-green-600 hover:bg-green-700",children:"Save Changes"})]})]})})]})};export{G as default};
