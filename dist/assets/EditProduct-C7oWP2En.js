import{s as l,j as r,B as m,A as P,u as I,x as D,y as L,v as B,D as p,a5 as F,a6 as O}from"./ui-components-CL-10tNC.js";import{u as A,f as H,r as o}from"./react-vendor-NfsKhbMh.js";import"./supabase-DQ7Oc2S5.js";const R=["Clothing","Electronics","Food & Beverages","Home & Living","Health & Beauty","Sports & Leisure","Books & Stationery","Services","Other"],G=()=>{const c=A(),{id:d}=H(),[y,g]=o.useState(!1),[h,n]=o.useState(null),[b,j]=o.useState([]),[x,v]=o.useState([]),[C,f]=o.useState(!1),[t,u]=o.useState({store_id:"",name:"",description:"",price:"",image_url:"",category:"",stock_quantity:"0"});o.useEffect(()=>{_(),S(),k()},[d]);const _=async()=>{try{const{data:e,error:a}=await l.from("stores").select("id, name").eq("is_active",!0).order("name");if(a)throw a;j(e||[])}catch(e){console.error("Error fetching stores:",e),n(e.message)}},S=async()=>{f(!0);try{const{data:e,error:a}=await l.from("product_categories").select("*").eq("is_active",!0).order("name");if(a)throw a;v(e||[])}catch(e){console.error("Error fetching product categories:",e)}finally{f(!1)}},k=async()=>{try{const{data:e,error:a}=await l.from("products").select("*, stores!inner(*)").eq("id",d).single();if(a)throw a;if(!e)throw new Error("Product not found");u({store_id:e.store_id,name:e.name,description:e.description||"",price:e.price.toString(),image_url:e.image_url||"",category:e.category,stock_quantity:e.stock_quantity.toString()})}catch(e){console.error("Error fetching product:",e),n(e.message),c("/admin/products")}},i=e=>{const{name:a,value:s}=e.target;u(E=>({...E,[a]:s}))},q=e=>{u(a=>({...a,image_url:e}))},N=()=>t.store_id?t.name.trim()?t.category?!t.price||parseFloat(t.price)<0?"Please enter a valid price":parseInt(t.stock_quantity)<0?"Stock quantity cannot be negative":null:"Category is required":"Product name is required":"Please select a store",w=async e=>{e.preventDefault();const a=N();if(a){n(a);return}g(!0),n(null);try{const{error:s}=await l.from("products").update({...t,price:parseFloat(t.price),stock_quantity:parseInt(t.stock_quantity),in_stock:parseInt(t.stock_quantity)>0,updated_at:new Date().toISOString()}).eq("id",d);if(s)throw s;c("/admin/products")}catch(s){console.error("Error updating product:",s),n(s.message)}finally{g(!1)}};return r.jsxs("div",{className:"max-w-2xl mx-auto py-6",children:[r.jsxs("div",{className:"mb-6",children:[r.jsxs(m,{variant:"ghost",onClick:()=>c("/admin/products"),className:"mb-4",children:[r.jsx(P,{className:"h-4 w-4 mr-2"}),"Back to Products"]}),r.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Edit Product"}),r.jsx("p",{className:"mt-1 text-sm text-gray-500",children:"Update your product information"})]}),r.jsx(I,{children:r.jsxs("form",{onSubmit:w,children:[r.jsx(D,{children:r.jsx(L,{children:"Product Information"})}),r.jsxs(B,{className:"space-y-4",children:[h&&r.jsx("div",{className:"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded relative",children:h}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Store"}),r.jsxs("select",{name:"store_id",value:t.store_id,onChange:i,className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",required:!0,children:[r.jsx("option",{value:"",children:"Select a store"}),b.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id))]})]}),r.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[r.jsx(p,{label:"Product Name",name:"name",value:t.name,onChange:i,required:!0,fullWidth:!0}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Category"}),r.jsxs("select",{name:"category",value:t.category,onChange:i,className:"mt-1 block w-full pl-3 pr-10 py-2 text-base border-gray-300 focus:outline-none focus:ring-blue-500 focus:border-blue-500 sm:text-sm rounded-md",required:!0,children:[r.jsx("option",{value:"",children:"Select a category"}),C?r.jsx("option",{value:"",disabled:!0,children:"Loading categories..."}):x.length>0?x.map(e=>r.jsx("option",{value:e.id,children:e.name},e.id)):R.map(e=>r.jsx("option",{value:e,children:e},e))]})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Description"}),r.jsx("textarea",{name:"description",value:t.description,onChange:i,rows:3,className:"w-full px-4 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Product Image"}),r.jsx(F,{value:t.image_url,onChange:q,onError:n,bucket:"products",folder:"products"})]}),r.jsxs("div",{className:"grid grid-cols-1 gap-4 sm:grid-cols-2",children:[r.jsx(p,{label:"Price",name:"price",type:"number",min:"0",step:"0.01",value:t.price,onChange:i,required:!0,fullWidth:!0}),r.jsx(p,{label:"Stock Quantity",name:"stock_quantity",type:"number",min:"0",value:t.stock_quantity,onChange:i,required:!0,fullWidth:!0})]})]}),r.jsxs(O,{className:"flex justify-end space-x-2",children:[r.jsx(m,{type:"button",variant:"secondary",onClick:()=>c("/admin/products"),children:"Cancel"}),r.jsx(m,{type:"submit",variant:"primary",isLoading:y,children:"Save Changes"})]})]})})]})};export{G as default};
