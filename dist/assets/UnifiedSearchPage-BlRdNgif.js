import{s as S,j as e,C as $,a as E,S as q,B as M,b as T,c as I,d as R}from"./ui-components-CL-10tNC.js";import{r as c,u as A}from"./react-vendor-NfsKhbMh.js";import{B as P}from"./BottomNavigation-BMDl6fTq.js";import{P as z}from"./PopUpAdDisplay-DBbJDXcm.js";import{u as B}from"./stores-BBDuH2RS.js";import"./supabase-DQ7Oc2S5.js";const G=({targetPage:l,storeId:h})=>{const[s,n]=c.useState([]),[p,y]=c.useState(0),[g,x]=c.useState(!1),[b,f]=c.useState(!1),[v,_]=c.useState(!0),[u,d]=c.useState(null),m=c.useRef(null),C=c.useRef(null);c.useEffect(()=>{const i=()=>{x(window.innerWidth<768)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]),c.useEffect(()=>{N();const i=S.channel("marquee_announcements").on("postgres_changes",{event:"*",schema:"public",table:"marquee_announcements"},()=>{N()}).subscribe();return()=>{i.unsubscribe()}},[l,h]),c.useEffect(()=>{if(s.length>1){const i=setInterval(()=>{b||y(w=>(w+1)%s.length)},g?8e3:6e3);return()=>clearInterval(i)}},[s.length,g,b]);const N=async()=>{try{_(!0),d(null);let i=S.from("marquee_announcements").select("*").eq("is_active",!0).eq("target_page",l);const w=new Date().toISOString();i=i.lte("start_date",w).or(`end_date.is.null,end_date.gte.${w}`),l==="store"&&h?i=i.eq("store_id",h):l==="home"&&(i=i.is("store_id",null));const{data:o,error:j}=await i.order("created_at",{ascending:!1});if(j)throw console.error("Supabase error:",j),j;const L=(o||[]).filter(k=>k&&k.content&&typeof k.content=="string"&&k.content.trim().length>0);n(L),y(0)}catch(i){console.error("Error fetching announcements:",i),d(i instanceof Error?i.message:"Failed to load announcements"),n([])}finally{_(!1)}},a=()=>f(!0),t=()=>f(!1);if(v)return null;if(u)return console.warn("Marquee error:",u),null;if(s.length===0)return null;const r=s[p];return!r||!r.content?null:e.jsxs("div",{className:"bg-gradient-to-r from-blue-600 via-blue-700 to-purple-600 text-white relative overflow-hidden shadow-lg",children:[e.jsxs("div",{className:`flex items-center ${g?"py-3 px-4":"py-2.5 px-6"}`,onMouseEnter:a,onMouseLeave:t,onTouchStart:a,onTouchEnd:t,children:[e.jsx("div",{className:"flex-shrink-0 mr-3",children:e.jsx("span",{className:"text-yellow-300 animate-pulse text-lg",children:"ðŸ“¢"})}),e.jsx("div",{ref:C,className:"flex-1 min-w-0 overflow-hidden relative",children:e.jsx("div",{ref:m,className:`marquee-text whitespace-nowrap ${g?"text-sm":"text-base"} font-medium ${b?"paused":""}`,children:r.content},`${p}-${r.id||p}`)}),s.length>1&&e.jsxs("div",{className:"flex items-center ml-4 flex-shrink-0",children:[!g&&e.jsx("div",{className:"flex items-center space-x-1.5",children:s.map((i,w)=>e.jsx("button",{onClick:()=>y(w),className:`w-2.5 h-2.5 rounded-full transition-all duration-300 hover:scale-110 ${w===p?"bg-yellow-300 shadow-lg":"bg-white/40 hover:bg-white/60"}`,"aria-label":`Show announcement ${w+1}`},w))}),g&&e.jsxs("div",{className:"text-xs bg-black/25 px-2.5 py-1 rounded-full backdrop-blur-sm",children:[p+1,"/",s.length]})]})]}),e.jsx("style",{jsx:!0,children:`
        .marquee-text {
          display: inline-block;
          animation: marquee-scroll 30s linear infinite;
          transform: translateX(100%);
        }
        
        .marquee-text.paused {
          animation-play-state: paused;
        }
        
        @keyframes marquee-scroll {
          0% {
            transform: translateX(100%);
          }
          100% {
            transform: translateX(-100%);
          }
        }
        
        /* Ensure smooth animation start */
        .marquee-text {
          will-change: transform;
          backface-visibility: hidden;
          perspective: 1000px;
        }

        /* Mobile optimizations */
        @media (max-width: 767px) {
          .marquee-text {
            animation-duration: 40s;
            font-size: 0.875rem;
            line-height: 1.4;
          }
        }

        /* Tablet optimizations */
        @media (min-width: 768px) and (max-width: 1023px) {
          .marquee-text {
            animation-duration: 38s;
          }
        }

        /* Large screen optimizations */
        @media (min-width: 1024px) {
          .marquee-text {
            animation-duration: 30s;
          }
        }

        /* High contrast mode support */
        @media (prefers-contrast: high) {
          .marquee-text {
            background: #000;
            color: #fff;
            text-shadow: none;
          }
        }

        /* Reduced motion support */
        @media (prefers-reduced-motion: reduce) {
          .marquee-text {
            animation: none;
            transform: none;
            text-align: center;
          }
        }

        /* Focus styles for accessibility */
        button:focus-visible {
          outline: 2px solid #fbbf24;
          outline-offset: 2px;
        }

        /* Smooth transitions */
        * {
          transition: background-color 0.2s ease, transform 0.2s ease;
        }
      `})]})},O=({currentPage:l,storeId:h,storeData:s})=>{const{settings:n,fetchSettings:p}=B();c.useEffect(()=>{p()},[p]),c.useEffect(()=>{n&&(y(),m(),g(),l==="store"&&s&&d())},[n,l,h,s]);const y=()=>{if(!n)return;const a=document.querySelector('meta[name="robots"]');a&&a.remove();const t=n.enable_google_indexing&&(l==="other"||n.indexed_pages.includes(l)),r=document.createElement("meta");r.name="robots",r.content=t?"index, follow":"noindex, nofollow",document.head.appendChild(r)},g=()=>{if(!n)return;v("title",x()),v("description",b());const a=f();a&&v("keywords",a),_()},x=()=>{const a=n.site_name||"shopview";switch(l){case"home":return n.default_meta_title||`${a} - Your Premier Shopping Destination`;case"store":return s!=null&&s.name?`${s.name} - ${a}`:`Store - ${a}`;default:return a}},b=()=>{switch(l){case"home":return n.default_meta_description||n.site_description||"Discover amazing stores and products at MyMall. Your one-stop shopping destination with the best deals and variety.";case"store":return s!=null&&s.description?s.description:s!=null&&s.name&&(s!=null&&s.location)?`Visit ${s.name} located in ${s.location}. Discover great products and deals.`:"Discover great products and deals at this store.";default:return n.site_description||"MyMall - Your Premier Shopping Destination"}},f=()=>{const a=n.default_meta_keywords?n.default_meta_keywords.split(",").map(t=>t.trim()):["shopping","mall","online store","products"];switch(l){case"home":return a.join(", ");case"store":const t=[...a];return s!=null&&s.name&&t.push(s.name),s!=null&&s.category&&t.push(s.category),s!=null&&s.location&&t.push(s.location),s!=null&&s.keywords&&t.push(...s.keywords),t.join(", ");default:return null}},v=(a,t)=>{if(a==="title"){document.title=t;return}const r=document.querySelector(`meta[name="${a}"]`);r&&r.remove();const i=document.createElement("meta");i.name=a,i.content=t,document.head.appendChild(i)},_=()=>{const a=x(),t=b(),r=n.site_name||"MyMall";u("og:title",a),u("og:description",t),u("og:site_name",r),u("og:type",l==="store"?"business.business":"website"),n.site_logo_url&&u("og:image",n.site_logo_url),u("twitter:card","summary_large_image"),u("twitter:title",a),u("twitter:description",t),n.site_logo_url&&u("twitter:image",n.site_logo_url)},u=(a,t)=>{const r=document.querySelector(`meta[property="${a}"], meta[name="${a}"]`);r&&r.remove();const i=document.createElement("meta");a.startsWith("twitter:")?i.name=a:i.setAttribute("property",a),i.content=t,document.head.appendChild(i)},d=()=>{if(!s)return;const a=document.querySelector('script[type="application/ld+json"]');a&&a.remove();const t={"@context":"https://schema.org","@type":"LocalBusiness",name:s.name,description:s.description||`Visit ${s.name} for great products and deals.`,url:window.location.href,...s.location&&{address:{"@type":"PostalAddress",addressLocality:s.location}},...s.category&&{category:s.category},potentialAction:{"@type":"ViewAction",target:window.location.href}},r=document.createElement("script");r.type="application/ld+json",r.textContent=JSON.stringify(t),document.head.appendChild(r)},m=()=>{if(!(n!=null&&n.google_analytics_measurement_id)){N();return}const a=n.google_analytics_measurement_id;if(window.gtag&&window.gaLoaded===a){C();return}N();const t=document.createElement("script");t.async=!0,t.src=`https://www.googletagmanager.com/gtag/js?id=${a}`,document.head.appendChild(t);const r=document.createElement("script");r.innerHTML=`
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', '${a}', {
        page_title: '${x()}',
        page_location: '${window.location.href}'
      });
    `,document.head.appendChild(r),window.gaLoaded=a},C=()=>{window.gtag&&window.gtag("config",n==null?void 0:n.google_analytics_measurement_id,{page_title:x(),page_location:window.location.href})},N=()=>{document.querySelectorAll('script[src*="googletagmanager.com/gtag/js"]').forEach(r=>r.remove()),document.querySelectorAll("script").forEach(r=>{r.innerHTML.includes("gtag(")&&r.innerHTML.includes("config")&&r.remove()}),delete window.gtag,delete window.dataLayer,delete window.gaLoaded};return null},H=()=>{const[l,h]=c.useState([]),[s,n]=c.useState(0),[p,y]=c.useState(!0),[g,x]=c.useState(!0);c.useEffect(()=>{b()},[]);const b=async()=>{try{y(!0);const{data:d,error:m}=await S.from("sponsored_content").select("*").eq("is_active",!0).lte("start_date",new Date().toISOString()).or(`end_date.is.null,end_date.gte.${new Date().toISOString()}`).order("display_order",{ascending:!0});if(m)throw m;h(d||[])}catch(d){console.error("Error fetching sponsored content:",d)}finally{y(!1)}},f=c.useCallback(()=>{l.length>0&&n(d=>(d+1)%l.length)},[l.length]),v=()=>{l.length>0&&n(d=>(d-1+l.length)%l.length)},_=d=>{n(d),x(!1)};c.useEffect(()=>{if(g&&l.length>1){const d=setInterval(f,5e3);return()=>clearInterval(d)}},[g,f,l.length]);const u=d=>{window.open(d,"_blank","noopener,noreferrer")};return p?e.jsx("div",{className:"w-full py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4",children:e.jsx("div",{className:"bg-gray-200 dark:bg-gray-700 rounded-lg h-64 animate-pulse"})})}):l.length===0?null:e.jsx("div",{className:"w-full py-8 bg-gray-50 dark:bg-gray-800",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Featured Content"}),e.jsx("span",{className:"px-3 py-1 bg-yellow-100 dark:bg-yellow-900 text-yellow-800 dark:text-yellow-200 text-xs font-medium rounded-full",children:"Sponsored"})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"overflow-hidden rounded-lg",children:e.jsx("div",{className:"flex transition-transform duration-500 ease-in-out",style:{transform:`translateX(-${s*100}%)`},children:l.map(d=>e.jsx("div",{className:"w-full flex-shrink-0 cursor-pointer",onClick:()=>u(d.redirect_url),children:e.jsxs("div",{className:"relative h-64 md:h-80 bg-gradient-to-br from-blue-100 to-purple-100 dark:from-blue-900 dark:to-purple-900 rounded-lg overflow-hidden",children:[e.jsx("img",{src:d.image_url,alt:d.title,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300"}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-6",children:e.jsx("h3",{className:"text-white text-xl font-bold",children:d.title})})]})},d.id))})}),l.length>1&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:v,className:"absolute left-2 top-1/2 -translate-y-1/2 bg-white/80 dark:bg-gray-800/80 hover:bg-white dark:hover:bg-gray-800 p-2 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Previous slide",children:e.jsx($,{className:"h-6 w-6 text-gray-800 dark:text-white"})}),e.jsx("button",{onClick:f,className:"absolute right-2 top-1/2 -translate-y-1/2 bg-white/80 dark:bg-gray-800/80 hover:bg-white dark:hover:bg-gray-800 p-2 rounded-full shadow-lg opacity-0 group-hover:opacity-100 transition-opacity","aria-label":"Next slide",children:e.jsx(E,{className:"h-6 w-6 text-gray-800 dark:text-white"})}),e.jsx("div",{className:"flex justify-center mt-4 gap-2",children:l.map((d,m)=>e.jsx("button",{onClick:()=>_(m),className:`h-2 rounded-full transition-all ${m===s?"w-8 bg-blue-600 dark:bg-blue-400":"w-2 bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500"}`,"aria-label":`Go to slide ${m+1}`},m))})]})]})]})})},Y=()=>{const l=A(),[h,s]=c.useState(""),[n,p]=c.useState(""),[y,g]=c.useState(!0),[x,b]=c.useState([]),[f,v]=c.useState([]),[_,u]=c.useState([]);c.useEffect(()=>{const t=setTimeout(()=>{p(h)},300);return()=>clearTimeout(t)},[h]);const d=c.useCallback(async()=>{try{g(!0);const[t,r,i]=await Promise.all([S.from("stores").select("*").eq("is_active",!0).eq("approval_status","approved").order("display_order",{ascending:!0,nullsLast:!0}).order("name"),S.from("hotels").select("*").eq("is_active",!0).eq("approval_status","approved").order("display_order",{ascending:!0,nullsLast:!0}).order("name"),S.from("taxis").select("*").eq("is_active",!0).eq("approval_status","approved").order("display_order",{ascending:!0,nullsLast:!0}).order("driver_name")]);t.data&&b(t.data),r.data&&v(r.data),i.data&&u(i.data)}catch(t){console.error("Error fetching data:",t)}finally{g(!1)}},[]);c.useEffect(()=>{d()},[d]);const m=c.useMemo(()=>{let t=[];const r=x.map(o=>({id:o.id,name:o.name,description:o.description,image_url:o.logo_url,location:o.location,category:o.category,username:o.username,service_type:"store",is_active:o.is_active}));t=[...t,...r];const i=f.map(o=>({id:o.id,name:o.name,description:o.description,image_url:o.logo_url,location:o.location,category:o.category,username:o.username,service_type:"hotel",is_active:o.is_active}));t=[...t,...i];const w=_.map(o=>({id:o.id,name:o.driver_name,description:o.description,image_url:o.photo_url,location:o.location,category:o.vehicle_type,username:o.username,service_type:"taxi",is_active:o.is_active}));return t=[...t,...w],n&&(t=t.filter(o=>{var j;return o.name.toLowerCase().includes(n.toLowerCase())||((j=o.description)==null?void 0:j.toLowerCase().includes(n.toLowerCase()))||o.location.toLowerCase().includes(n.toLowerCase())})),t.sort((o,j)=>{const L=o.name.toLowerCase().includes(n.toLowerCase()),k=j.name.toLowerCase().includes(n.toLowerCase());return L&&!k?-1:!L&&k?1:0}),t},[x,f,_,n]),C=t=>{t.service_type==="store"?l(`/${t.username}`):t.service_type==="hotel"?l(`/hotel/${t.username}`):t.service_type==="taxi"&&l(`/taxi/${t.username}`)},N=t=>{switch(t){case"store":return e.jsx(R,{className:"h-4 w-4"});case"hotel":return e.jsx(I,{className:"h-4 w-4"});case"taxi":return e.jsx(T,{className:"h-4 w-4"});default:return null}},a=t=>{switch(t){case"store":return"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200";case"hotel":return"bg-green-100 text-green-800 dark:bg-green-900 dark:text-green-200";case"taxi":return"bg-orange-100 text-orange-800 dark:bg-orange-900 dark:text-orange-200";default:return"bg-gray-100 text-gray-800"}};return e.jsxs("div",{className:"min-h-screen bg-white pb-20 dark:bg-gray-900",children:[e.jsx(O,{currentPage:"home"}),e.jsx(G,{targetPage:"home"}),e.jsx(z,{targetPage:"home"}),e.jsx("div",{className:`transition-all duration-300 ${n?"pt-8":"pt-32"}`,children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl md:text-5xl font-bold text-gray-900 dark:text-white mb-8",children:"What can I do for you?"}),e.jsx("div",{className:"max-w-2xl mx-auto mb-6",children:e.jsxs("div",{className:"relative shadow-lg rounded-full",children:[e.jsx("input",{type:"text",value:h,onChange:t=>s(t.target.value),placeholder:"Search for stores, hotels, or taxis",className:"w-full px-6 py-4 pr-12 rounded-full border-none bg-white dark:bg-gray-800 text-gray-900 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),e.jsx(q,{className:"absolute right-4 top-1/2 -translate-y-1/2 h-5 w-5 text-gray-400"})]})})]}),n?y?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):m.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(q,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500 text-lg dark:text-gray-400",children:"No results found"}),e.jsx(M,{variant:"link",onClick:()=>s(""),className:"mt-4",children:"Clear search"})]}):e.jsxs("div",{className:"mt-8 max-w-3xl mx-auto",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["About ",m.length," results"]}),e.jsx("div",{className:"space-y-6",children:m.map(t=>e.jsx("div",{onClick:()=>C(t),className:"group cursor-pointer",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"flex-shrink-0",children:t.image_url?e.jsx("img",{src:t.image_url,alt:t.name,className:"w-20 h-20 rounded-lg object-cover"}):e.jsx("div",{className:"w-20 h-20 rounded-lg bg-gradient-to-br from-blue-100 to-purple-100 dark:from-blue-900 dark:to-purple-900 flex items-center justify-center",children:e.jsx("span",{className:"text-xl font-bold text-blue-600 dark:text-blue-300",children:t.name.substring(0,2).toUpperCase()})})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-start gap-2 mb-1",children:[e.jsx("h3",{className:"text-xl text-blue-700 dark:text-blue-400 group-hover:underline font-normal",children:t.name}),e.jsxs("span",{className:`flex items-center gap-1 px-2 py-0.5 rounded-full text-xs font-medium whitespace-nowrap ${a(t.service_type)}`,children:[N(t.service_type),t.service_type]})]}),e.jsxs("div",{className:"flex items-center gap-3 mb-2 text-sm text-gray-600 dark:text-gray-400",children:[e.jsxs("span",{className:"flex items-center",children:[e.jsx("svg",{className:"w-4 h-4 mr-1",fill:"currentColor",viewBox:"0 0 20 20",children:e.jsx("path",{fillRule:"evenodd",d:"M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z",clipRule:"evenodd"})}),t.location]}),e.jsx("span",{children:"â€¢"}),e.jsx("span",{children:t.category})]}),t.description&&e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300 line-clamp-2 leading-relaxed",children:t.description})]})]})},`${t.service_type}-${t.id}`))})]}):e.jsx("div",{className:"mt-12",children:e.jsx(H,{})})]})}),e.jsx(P,{})]})};export{Y as default};
